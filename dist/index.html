<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Cursor Ë°å‰∏∫‰ΩìÊ£Ä - Vibe Coding</title>
    <!-- API Á´ØÁÇπÈÖçÁΩÆÔºàCloudflare WorkersÔºâ -->
    <meta name="api-endpoint" content="https://cursor-clinical-analysis.psterman.workers.dev/">
    <!-- ÂºïÂÖ•ÂøÖË¶ÅÁöÑÂ∫ì -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.1.0/wordcloud2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'JetBrains Mono', monospace; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #27272a; border-radius: 0; }
        /* Terminal Hacker Style - ÊûÅÁÆÄÁªàÁ´ØÁ≥ªÁªü */
        :root {
            --bg-color: #050505;
            --card-bg: rgba(24, 24, 27, 0.8);
            --card-border: #27272a;
            --text-main: #ffffff;
            --text-dim: #71717a;
            --accent-terminal: #00ff41;
            --accent-cyan: #3b82f6;
            --glass-blur: none;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 255, 65, 0.02) 2px,
                    rgba(0, 255, 65, 0.02) 4px
                ),
                radial-gradient(
                    circle,
                    rgba(0, 255, 65, 0.03) 1px,
                    transparent 1px
                );
            background-size: 100% 4px, 20px 20px;
        }
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
            background: linear-gradient(
                180deg,
                transparent 0%,
                rgba(0, 255, 65, 0.05) 50%,
                transparent 100%
            );
            animation: scanline 8s linear infinite;
        }
        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }
        .container, header, .stats-grid, .chart-card {
            position: relative;
            z-index: 10;
        }
        .top-glow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: var(--accent-terminal);
            z-index: 1000;
            box-shadow: 0 0 4px var(--accent-terminal);
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 80px;
            position: relative;
        }
        .container::before {
            content: '‚ñà';
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: var(--accent-terminal);
            font-size: 16px;
            animation: cursorBlink 0.8s steps(2) infinite;
            pointer-events: none;
            z-index: 1000;
        }
        header {
            text-align: center;
            padding: 60px 20px;
            animation: fadeInDown 0.8s ease-out;
            position: relative;
        }
        header::after {
            content: '';
            display: block;
            width: 60px;
            height: 2px;
            background: var(--accent-terminal);
            margin: 30px auto 0;
            box-shadow: 0 0 8px var(--accent-terminal);
        }
        .logo-box {
            display: inline-block;
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--card-border);
            border-radius: 2px;
            margin-bottom: 20px;
            font-size: 16px;
            color: var(--accent-terminal);
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }
        .logo-box::before {
            content: '> ';
            color: var(--accent-terminal);
            text-shadow: 0 0 4px var(--accent-terminal);
        }
        h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            letter-spacing: 0.1em;
            color: var(--text-main);
            margin-bottom: 15px;
            text-transform: uppercase;
            font-family: 'JetBrains Mono', monospace;
        }
        h1::before {
            content: '> ';
            color: var(--accent-terminal);
            margin-right: 0.2em;
            text-shadow: 0 0 8px var(--accent-terminal);
        }
        .subtitle {
            color: var(--text-dim);
            font-size: 1.1rem;
            font-family: 'JetBrains Mono', monospace;
            letter-spacing: 0.05em;
        }
        .subtitle::before {
            content: '// ';
            color: var(--accent-terminal);
            opacity: 0.6;
        }
        .upload-icon {
            width: 64px;
            height: 64px;
            margin-bottom: 20px;
            display: block;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }
        .stats-grid.hidden {
            display: none;
        }
        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 2px;
            padding: 24px;
            transition: border-color 0.2s ease;
            position: relative;
        }
        .stat-card:hover {
            border-color: var(--accent-terminal);
            box-shadow: 0 0 8px rgba(0, 255, 65, 0.3);
        }
        .stat-label {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 16px;
            color: var(--text-dim);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .stat-value {
            font-size: 36px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: #fff;
        }
        .stat-comparison {
            font-size: 14px;
            margin-top: 10px;
            color: #ffffff;
            font-weight: 500;
        }
        .stat-comparison strong {
            color: var(--accent-terminal);
            font-weight: 700;
        }
        /* ÊéíÂêçÊòæÁ§∫Ê†∑ÂºèÔºàÂè≥‰∏ãËßíÔºâ */
        .stat-ranking {
            position: absolute;
            bottom: 12px;
            right: 12px;
            font-size: 12px;
            color: var(--text-dim);
            font-weight: 600;
            background: transparent;
            padding: 4px 8px;
            border-radius: 2px;
            border: 1px solid var(--card-border);
            font-family: 'JetBrains Mono', monospace;
        }
        .stat-ranking.has-rank {
            color: var(--accent-terminal);
            background: rgba(0, 255, 65, 0.1);
            border-color: var(--accent-terminal);
        }
        .wordcloud-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }
        .wordcloud-section.hidden {
            display: none;
        }
        .chart-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 2px;
            padding: 24px;
            position: relative;
            overflow: hidden;
        }
        .chart-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: var(--accent-terminal);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .chart-card:hover::before {
            opacity: 1;
            box-shadow: 0 0 8px var(--accent-terminal);
        }
        .chart-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-main);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .chart-title::before {
            content: '> ';
            color: var(--accent-terminal);
        }
        .wordcloud-container {
            width: 100%;
            height: 400px;
            position: relative;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 19px,
                    rgba(0, 255, 65, 0.05) 19px,
                    rgba(0, 255, 65, 0.05) 20px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 19px,
                    rgba(0, 255, 65, 0.05) 19px,
                    rgba(0, 255, 65, 0.05) 20px
                );
            border-radius: 2px;
            overflow: hidden;
            border: 1px solid var(--card-border);
        }
        .wordcloud-container canvas {
            width: 100% !important;
            height: 100% !important;
        }
        .prompts-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .prompt-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--card-border);
            border-radius: 2px;
            transition: all 0.2s ease;
        }
        .prompt-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--accent-terminal);
        }
        .prompt-rank {
            font-size: 16px;
            font-weight: 700;
            color: var(--accent-terminal);
            min-width: 30px;
        }
        .prompt-text {
            flex: 1;
            font-size: 16px;
            color: var(--text-main);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-family: 'JetBrains Mono', monospace;
        }
        .prompt-text::before {
            content: '$ ';
            color: var(--accent-terminal);
            opacity: 0.6;
        }
        .prompt-count {
            font-size: 15px;
            color: var(--text-dim);
            white-space: nowrap;
        }
        .chat-list-section {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 2px;
            overflow: hidden;
        }
        .chat-list-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-bottom: 1px solid var(--card-border);
            flex-wrap: wrap;
            gap: 12px;
        }
        .chat-list-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-main);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .chat-list-title::before {
            content: '> ';
            color: var(--accent-terminal);
        }
        .chat-list-controls {
            display: flex;
            gap: 12px;
        }
        .search-input {
            padding: 10px 16px;
            font-size: 16px;
            border: 1px solid var(--card-border);
            border-radius: 2px;
            width: 300px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-main);
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s ease;
        }
        .search-input:focus {
            outline: none;
            border-color: var(--accent-terminal);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 4px var(--accent-terminal);
        }
        .search-input::placeholder {
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .chat-list {
            max-height: 600px;
            overflow-y: auto;
        }
        .chat-item {
            padding: 16px 20px;
            border-bottom: 1px solid var(--card-border);
            transition: background 0.2s ease;
        }
        .chat-item:hover {
            background: rgba(255, 255, 255, 0.03);
        }
        .chat-item:last-child {
            border-bottom: none;
        }
        .chat-item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
            flex-wrap: wrap;
            gap: 8px;
        }
        .chat-role {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 2px;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid;
        }
        .role-user {
            background: transparent;
            color: var(--accent-terminal);
            border-color: var(--accent-terminal);
        }
        .role-ai {
            background: transparent;
            color: var(--accent-terminal);
            border-color: var(--accent-terminal);
        }
        .chat-time {
            font-size: 14px;
            color: var(--text-dim);
        }
        .chat-item-content {
            font-size: 16px;
            color: var(--text-dim);
            line-height: 1.6;
            font-family: 'JetBrains Mono', monospace;
        }
        .chat-item-content p {
            margin: 0;
        }
        .chat-item-content::first-line {
            color: var(--text-main);
        }
        .pagination-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-top: 1px solid var(--card-border);
            background: rgba(255, 255, 255, 0.02);
            flex-wrap: wrap;
            gap: 16px;
        }
        .pagination-info {
            font-size: 16px;
            color: var(--text-dim);
        }
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .pagination-btn {
            padding: 8px 16px;
            font-size: 16px;
            border: 1px solid var(--card-border);
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-main);
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'JetBrains Mono', monospace;
        }
        .pagination-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-terminal);
        }
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .pagination-pages {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .pagination-page-btn {
            min-width: 36px;
            height: 36px;
            padding: 0 12px;
            font-size: 16px;
            border: 1px solid var(--card-border);
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-main);
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'JetBrains Mono', monospace;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .pagination-page-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-terminal);
        }
        .pagination-page-btn.active {
            background: var(--accent-terminal);
            color: #050505;
            border-color: var(--accent-terminal);
        }
        .pagination-ellipsis {
            padding: 0 8px;
            color: var(--text-dim);
            font-size: 16px;
        }
        .vibe-codinger-section {
            margin-bottom: 32px;
        }
        .vibe-header {
            text-align: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--card-border);
            position: relative;
        }
        .vibe-header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 1px;
            background: var(--accent-terminal);
            box-shadow: 0 0 8px var(--accent-terminal);
        }
        .vibe-title {
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-main);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .vibe-title::before {
            content: '> ';
            color: var(--accent-terminal);
        }
        .vibe-badge {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px 40px;
            border-radius: 2px;
            margin-bottom: 16px;
            transition: border-color 0.2s ease;
            border: 1px solid var(--card-border);
        }
        .vibe-badge:hover {
            border-color: var(--accent-terminal);
        }
        .vibe-type {
            font-size: 36px;
            font-weight: 700;
            letter-spacing: 0.15em;
            color: var(--text-main);
            text-transform: uppercase;
            font-family: 'JetBrains Mono', monospace;
        }
        .vibe-name {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-main);
        }
        .vibe-description {
            font-size: 16px;
            color: var(--text-dim);
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }
        .vibe-dimensions {
            margin-bottom: 32px;
        }
        .dimensions-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-main);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .dimensions-title::before {
            content: '> ';
            color: var(--accent-terminal);
        }
        .dimension-card {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 2px;
            border: 1px solid var(--card-border);
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }
        .dimension-card:hover {
            border-color: var(--accent-terminal);
            background: rgba(255, 255, 255, 0.05);
        }
        .dimension-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        .dimension-key {
            font-size: 26px;
            font-weight: 700;
            color: var(--accent-terminal);
            min-width: 40px;
        }
        .dimension-label {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-main);
            flex: 1;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .dimension-value {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-main);
            min-width: 50px;
            text-align: right;
            font-family: 'JetBrains Mono', monospace;
        }
        .dimension-level {
            font-size: 16px;
            padding: 4px 12px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-dim);
            font-weight: 600;
            border: 1px solid var(--card-border);
        }
        .dimension-bar-container {
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0;
            overflow: hidden;
            margin-bottom: 12px;
            border: 1px solid var(--card-border);
            display: flex;
        }
        .dimension-bar {
            height: 100%;
            border-radius: 0;
            transition: width 0.3s steps(20);
            background: repeating-linear-gradient(
                90deg,
                var(--accent-terminal),
                var(--accent-terminal) 6px,
                rgba(0, 255, 65, 0.5) 6px,
                rgba(0, 255, 65, 0.5) 8px,
                var(--accent-terminal) 8px,
                var(--accent-terminal) 14px,
                transparent 14px,
                transparent 16px
            );
            box-shadow: 
                inset 0 0 8px var(--accent-terminal),
                0 0 4px rgba(0, 255, 65, 0.5);
            position: relative;
        }
        .dimension-bar::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 2px;
            height: 100%;
            background: var(--accent-terminal);
            box-shadow: 0 0 6px var(--accent-terminal);
            animation: barCursor 0.8s steps(2) infinite;
        }
        @keyframes barCursor {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        .dimension-interpretation {
            font-size: 17px;
            color: var(--text-main);
            margin-bottom: 8px;
            font-weight: 500;
            line-height: 1.6;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 0;
            border-left: 3px solid var(--accent-terminal);
            font-style: normal;
        }
        .dimension-interpretation::before {
            content: '// ';
            color: var(--accent-terminal);
            opacity: 0.6;
        }
        .dimension-desc {
            font-size: 14px;
            color: var(--text-dim);
            line-height: 1.5;
        }
        .vibe-roast-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--card-border);
            border-radius: 2px;
            padding: 24px;
            margin-bottom: 32px;
        }
        .roast-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 12px;
        }
        .roast-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-main);
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .roast-title::before {
            content: '> ';
            color: var(--accent-terminal);
        }
        .personality-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--accent-terminal);
            padding: 6px 16px;
            background: transparent;
            border-radius: 2px;
            border: 1px solid var(--accent-terminal);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .vibe-index {
            font-size: 16px;
            color: var(--text-dim);
            font-family: 'JetBrains Mono', monospace;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
            border: 1px solid var(--card-border);
        }
        .roast-content {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 0;
            border-left: 4px solid var(--accent-terminal);
            margin-bottom: 16px;
        }
        .roast-text {
            font-size: 17px;
            line-height: 1.8;
            color: var(--text-main);
            margin: 0;
            font-style: normal;
        }
        .roast-text::before {
            content: '> ';
            color: var(--accent-terminal);
            opacity: 0.8;
        }
        .dimension-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .dimension-tag {
            font-size: 15px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--card-border);
            border-radius: 2px;
            color: var(--text-main);
            font-weight: 500;
        }
        .vibe-traits {
            margin-bottom: 32px;
        }
        .traits-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-main);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .traits-title::before {
            content: '> ';
            color: var(--accent-terminal);
        }
        .traits-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        .trait-tag {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--accent-terminal);
            border-radius: 2px;
            font-size: 16px;
            font-weight: 500;
            color: var(--accent-terminal);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .vibe-fingerprint {
            margin-bottom: 32px;
        }
        .fingerprint-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-main);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .fingerprint-title::before {
            content: '> ';
            color: var(--accent-terminal);
        }
        .fingerprint-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
        }
        .fingerprint-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 2px;
            border: 1px solid var(--card-border);
            text-align: center;
            transition: border-color 0.2s ease;
        }
        .fingerprint-item:hover {
            border-color: var(--accent-terminal);
        }
        .fingerprint-label {
            font-size: 15px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .fingerprint-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-main);
            font-family: 'JetBrains Mono', monospace;
        }
        .vibe-chart-container {
            margin-bottom: 32px;
        }
        .vibe-chart-container .chart-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-main);
        }
        .chart-wrapper {
            position: relative;
            height: 400px;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 19px,
                    rgba(0, 255, 65, 0.05) 19px,
                    rgba(0, 255, 65, 0.05) 20px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 19px,
                    rgba(0, 255, 65, 0.05) 19px,
                    rgba(0, 255, 65, 0.05) 20px
                );
            border-radius: 2px;
            padding: 20px;
            border: 1px solid var(--card-border);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #vibeRadarChart {
            max-height: 100%;
            max-width: 100%;
        }
        .btn {
            background: var(--accent-terminal);
            color: #050505;
            border: 1px solid var(--accent-terminal);
            padding: 12px 32px;
            border-radius: 2px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 18px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .btn:hover {
            background: transparent;
            color: var(--accent-terminal);
            box-shadow: 0 0 8px var(--accent-terminal);
        }
        .btn:active {
            transform: scale(0.98);
        }
        .hidden {
            display: none !important;
        }
        @keyframes fadeInDown {
            0% { opacity: 0; transform: translateY(-20px); }
            50% { opacity: 0.5; }
            100% { opacity: 1; transform: translateY(0); }
        }
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            .wordcloud-section {
                grid-template-columns: 1fr;
            }
            .chat-list-header {
                flex-direction: column;
                align-items: stretch;
            }
            .search-input {
                width: 100%;
            }
            .pagination-container {
                flex-direction: column;
                align-items: stretch;
            }
            /* ÂàÜ‰∫´Ê®°Âºè‰∏ãÔºåÁßªÂä®Á´Ø‰ΩøÁî®ÂçïÂàóÂ∏ÉÂ±Ä */
            .full-report-container .stats-grid {
                grid-template-columns: 1fr !important;
            }
            .full-report-container .ranking-section .stats-grid {
                grid-template-columns: 1fr !important;
            }
        }
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        /* ÁªàÁ´ØÈ£éÊ†ºÊï∞Â≠óÂä®Áîª */
        @keyframes numberPulse {
            0%, 100% { 
                opacity: 1; 
                color: var(--text-main);
            }
            25% { 
                opacity: 0.3; 
            }
            50% { 
                opacity: 1; 
                color: var(--accent-terminal);
                text-shadow: 0 0 8px var(--accent-terminal);
            }
            75% { 
                opacity: 0.5; 
            }
        }
        @keyframes numberFlash {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0; }
        }
        .stat-value.animate-pulse {
            animation: numberPulse 0.3s steps(4);
        }
        .stat-value.animate-flash {
            animation: numberFlash 0.2s steps(2);
        }
        .stat-value.updating {
            position: relative;
        }
        .stat-value.updating::after {
            content: '_';
            position: absolute;
            right: -12px;
            color: var(--accent-terminal);
            animation: cursorBlink 0.8s steps(2) infinite;
        }
        @keyframes cursorBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
    </style>
  <script type="module" crossorigin src="/cursor-lab/assets/main-874rUWch.js"></script>
</head>
<body class="bg-[#050505]">
    <div id="root"></div>
    <!-- ÂÆåÊï¥Êä•ÂëäÂÆπÂô®ÔºàÈöêËóèÔºåÁ≠âÂæÖÊ∏≤ÊüìÔºâ -->
    <div id="fullReportContainer" style="display: none;"></div>


    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Ê®°Êãü Lucide ÂõæÊ†áÁªÑ‰ª∂
        const Icon = ({ name, size = 24, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (iconRef.current) {
                    lucide.createIcons();
                }
            }, [name]);
            return <i data-lucide={name} className={className} style={{width: size, height: size}}></i>;
        };

        // ÁªüËÆ°Âç°ÁâáÂ≠êÁªÑ‰ª∂
        function StatBox({ label, value, sub, color, lang = 'zh-CN' }) {
            const isEn = lang === 'en';
            // Â¶ÇÊûú sub ÊòØ '#'ÔºåÈúÄË¶ÅÊîæÂú®Êï∞Â≠óÂâçÈù¢
            const displayValue = (sub === '#' && isEn) ? `${sub}${value}` : value;
            const displaySub = (sub === '#' && isEn) ? '' : sub;
            return (
                <div className="bg-zinc-950/50 border border-zinc-800 rounded-sm w-full flex flex-col" style={{padding: '20px'}}>
                    <div className={`text-zinc-600 uppercase tracking-widest font-bold ${isEn ? 'text-[10px] leading-tight' : 'text-[11px]'}`} style={{minHeight: isEn ? '28px' : '24px', marginBottom: '12px', display: 'flex', alignItems: 'flex-start'}}>{label}</div>
                    <div className={`text-3xl font-black ${color} font-mono flex items-baseline`}>
                        {displayValue}
                        {displaySub && <span className="text-sm ml-1 opacity-50 font-normal text-zinc-400">{displaySub}</span>}
                    </div>
                </div>
            );
        }

        function App() {
            // ËØ≠Ë®ÄÁä∂ÊÄÅÁÆ°ÁêÜ
            const [lang, setLang] = useState(() => {
                // ‰ªé localStorage ËØªÂèñ‰øùÂ≠òÁöÑËØ≠Ë®ÄËÆæÁΩÆÔºåÈªòËÆ§‰∏∫‰∏≠Êñá
                const savedLang = localStorage.getItem('appLanguage');
                return savedLang === 'en' ? 'en' : 'zh-CN';
            });
            
            // i18n ËæÖÂä©ÂáΩÊï∞
            const t = (key) => {
                if (window.i18n && window.i18n.getText) {
                    return window.i18n.getText(key, lang);
                }
                return key;
            };
            
            // ÈáçÊñ∞ÂàõÂª∫ Dashboard DOMÔºà‰ΩøÁî®ÂΩìÂâçËØ≠Ë®ÄÔºâ
            const recreateDashboardDOM = (currentLang) => {
                const container = document.getElementById('fullReportContainer');
                if (!container || !window.analysisModule) return;
                
                // Ëé∑ÂèñÂΩìÂâçËØ≠Ë®Ä‰∏ãÁöÑÁøªËØëÂáΩÊï∞
                const getText = (key) => {
                    if (window.i18n && window.i18n.getText) {
                        return window.i18n.getText(key, currentLang);
                    }
                    return key;
                };
                
                const loadingText = getText('dashboard.loading');
                
                // ÈáçÊñ∞ÂàõÂª∫ Dashboard DOM ÁªìÊûÑ
                container.innerHTML = `
                    <div class="full-report-container" style="max-width: 1100px; margin: 0 auto; padding: 20px; padding-bottom: 80px;">
                        <header style="text-align: center; padding: 60px 20px;">
                            <div class="logo-box" style="display: inline-block; padding: 8px 16px; background: transparent; border: 1px solid var(--card-border); border-radius: 2px; margin-bottom: 20px; font-size: 14px; color: var(--accent-terminal); text-transform: uppercase; letter-spacing: 0.15em;">> ${getText('dashboard.clinicalAnalysis')}</div>
                            <h1 style="font-size: clamp(2rem, 5vw, 3.5rem); font-weight: 700; letter-spacing: 0.1em; color: var(--text-main); margin-bottom: 15px; text-transform: uppercase; font-family: 'JetBrains Mono', monospace;"><a href="https://github.com/psterman/cursor-lab" target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: none; display: inline-block; transition: all 0.3s ease; position: relative; filter: blur(2px);" onmouseenter="this.style.filter='blur(0px)'; this.style.textShadow='0 0 20px var(--accent-terminal), 0 0 40px var(--accent-terminal)';" onmouseleave="this.style.filter='blur(2px)'; this.style.textShadow='none';">> ${getText('dashboard.reportTitle')}</a></h1>
                            <p class="subtitle" style="color: var(--text-dim); font-size: 1.1rem;">${getText('dashboard.reportSubtitle')}</p>
                        </header>
                        
                        <div id="dashboardSection">
                            <!-- ÂÆûÊó∂ÁªüËÆ°Âå∫Âüü -->
                            <div class="realtime-stats-section" style="background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 2px; padding: 24px; margin-bottom: 40px;">
                                <h3 class="chart-title" style="margin-bottom: 20px; text-align: center;">${getText('dashboard.realtimeStats')}</h3>
                                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                    <div class="stat-card" style="text-align: center;">
                                        <p class="stat-label">${getText('dashboard.totalUsers')}</p>
                                        <p class="stat-value" id="totalTestUsers" style="color: #ffffff;">${loadingText}</p>
                                        <p class="stat-comparison">${getText('dashboard.personUnit')}</p>
                                    </div>
                                    <div class="stat-card" style="text-align: center;">
                                        <p class="stat-label">${getText('dashboard.techRank')}</p>
                                        <p class="stat-value" id="techRank" style="color: #ffffff;">${loadingText}</p>
                                        <p class="stat-comparison">${getText('dashboard.rankUnit')}</p>
                                    </div>
                                    <div class="stat-card" style="text-align: center;">
                                        <p class="stat-label">${getText('dashboard.personalityUnlock')}</p>
                                        <p class="stat-value" id="personalityUnlock" style="color: #ffffff;">${loadingText}</p>
                                        <p class="stat-comparison">243 ${getText('dashboard.personalityUnit')}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Ê®™ÂêëÊéíÂêçÂå∫Âüü -->
                            <div class="ranking-section" style="background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 2px; padding: 24px; margin-bottom: 40px;">
                                <h3 class="chart-title" style="margin-bottom: 20px; text-align: center;">${getText('dashboard.globalRankings')}</h3>
                                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;" id="rankingCards">
                                    <div class="stat-card" style="text-align: center;">
                                        <p class="stat-label" style="color: var(--text-dim);">${getText('dashboard.cyberBowRanking')}</p>
                                        <p class="stat-value" id="rankingQingCount" style="color: #ffffff;">--</p>
                                        <p class="stat-comparison" id="rankingQingCountPercent">--</p>
                                    </div>
                                    <div class="stat-card" style="text-align: center;">
                                        <p class="stat-label" style="color: var(--text-dim);">${getText('dashboard.bossModeRanking')}</p>
                                        <p class="stat-value" id="rankingBuCount" style="color: #ffffff;">--</p>
                                        <p class="stat-comparison" id="rankingBuCountPercent">--</p>
                                    </div>
                                    <div class="stat-card" style="text-align: center;">
                                        <p class="stat-label" style="color: var(--text-dim);">${getText('dashboard.aiTeasingRanking')}</p>
                                        <p class="stat-value" id="rankingUserMessages" style="color: #ffffff;">--</p>
                                        <p class="stat-comparison" id="rankingUserMessagesPercent">--</p>
                                    </div>
                                    <div class="stat-card" style="text-align: center;">
                                        <p class="stat-label" style="color: var(--text-dim);">${getText('dashboard.banterOutputRanking')}</p>
                                        <p class="stat-value" id="rankingTotalChars" style="color: #ffffff;">--</p>
                                        <p class="stat-comparison" id="rankingTotalCharsPercent">--</p>
                                    </div>
                                    <div class="stat-card" style="text-align: center;">
                                        <p class="stat-label" style="color: var(--text-dim);">${getText('dashboard.avgLengthRanking')}</p>
                                        <p class="stat-value" id="rankingAvgLength" style="color: #ffffff;">--</p>
                                        <p class="stat-comparison" id="rankingAvgLengthPercent">--</p>
                                    </div>
                                    <div class="stat-card" style="text-align: center;">
                                        <p class="stat-label" style="color: var(--text-dim);">${getText('dashboard.daysOnDutyRanking')}</p>
                                        <p class="stat-value" id="rankingUsageDays" style="color: #ffffff;">--</p>
                                        <p class="stat-comparison" id="rankingUsageDaysPercent">--</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Áª¥Â∫¶ÂæóÂàÜÊéíË°åÊ¶ú -->
                            <div class="dimension-ranking-section" style="background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 2px; padding: 24px; margin-bottom: 40px;">
                                <h3 class="chart-title" style="margin-bottom: 20px; text-align: center;">${getText('dashboard.dimensionRankingTitle')}</h3>
                                <div id="dimensionRankingList" class="prompts-list"></div>
                            </div>

                            <div class="stats-grid" id="exportArea">
                                <div class="stat-card">
                                    <p class="stat-label">${getText('dashboard.daysOnDutyCount')}</p>
                                    <p class="stat-value" id="totalConversations">0</p>
                                    <p class="stat-comparison">${getText('statsLabels.unit.days')}</p>
                                    <span class="stat-ranking" id="rankingUsageDaysBadge">--</span>
                                </div>
                                <div class="stat-card">
                                    <p class="stat-label">${getText('dashboard.aiTeasingCount')}</p>
                                    <p class="stat-value" id="userMessages">0</p>
                                    <span class="stat-ranking" id="rankingUserMessagesBadge">--</span>
                                </div>
                            </div>
                            
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <p class="stat-label">${getText('dashboard.cyberBowCount')}</p>
                                    <p class="stat-value" id="qingCount">0</p>
                                    <p class="stat-comparison">${getText('dashboard.timesUnit')}</p>
                                    <span class="stat-ranking" id="rankingQingCountBadge">--</span>
                                </div>
                                <div class="stat-card">
                                    <p class="stat-label">${getText('dashboard.bossModeCount')}</p>
                                    <p class="stat-value" id="buCount">0</p>
                                    <p class="stat-comparison">${getText('dashboard.timesUnit')}</p>
                                    <span class="stat-ranking" id="rankingBuCountBadge">--</span>
                                </div>
                            </div>
                            
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <p class="stat-label">${getText('dashboard.banterOutputCount')}</p>
                                    <p class="stat-value" id="totalUserChars">0</p>
                                    <p class="stat-comparison">${getText('dashboard.charUnit')}</p>
                                    <span class="stat-ranking" id="rankingTotalCharsBadge">--</span>
                                </div>
                                <div class="stat-card">
                                    <p class="stat-label">${getText('dashboard.avgLengthCount')}</p>
                                    <p class="stat-value" id="avgUserMessageLength">0</p>
                                    <p class="stat-comparison">${getText('dashboard.charUnit')}</p>
                                    <span class="stat-ranking" id="rankingAvgLengthBadge">--</span>
                                </div>
                                <div class="stat-card hidden" id="questionCard">
                                    <p class="stat-label">${getText('dashboard.questionCount')}</p>
                                    <p class="stat-value" id="questionMessageCount">0</p>
                                    <p class="stat-comparison">${getText('statsLabels.unit.count')}</p>
                                </div>
                            </div>
                            
                            <div class="wordcloud-section">
                                <div class="chart-card">
                                    <h3 class="chart-title">${getText('dashboard.aiMerits')}</h3>
                                    <div class="wordcloud-container">
                                        <canvas id="chineseWordCloud"></canvas>
                                    </div>
                                </div>
                                <div class="chart-card">
                                    <h3 class="chart-title">${getText('dashboard.siliconValleySlang')}</h3>
                                    <div class="wordcloud-container">
                                        <canvas id="englishWordCloud"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="chart-card" style="margin-top: 40px;">
                                <h3 class="chart-title"><span style="color: var(--accent-terminal);">üó£Ô∏è</span> ${getText('dashboard.vibeCodingSlang')}</h3>
                                <div class="prompts-list" id="topChineseWordsList"></div>
                            </div>
                            
                            <div class="chart-card" id="techStackSection" style="display: none; margin-top: 40px;">
                                <h3 class="chart-title">${getText('dashboard.userTechStack')}</h3>
                                <div class="prompts-list" id="techStackList"></div>
                            </div>
                            
                            <div class="vibe-codinger-section chart-card" id="vibeCodingerSection" style="margin-top: 40px;"></div>
                            
                            <div class="chat-list-section" style="margin-top: 40px;">
                                <div class="chat-list-header">
                                    <h3 class="chat-list-title">${getText('chatList.title')}</h3>
                                    <div class="chat-list-controls">
                                        <input type="text" id="searchInput" class="search-input" placeholder="${getText('chatList.searchPlaceholder')}">
                                    </div>
                                </div>
                                <div class="chat-list" id="chatList"></div>
                                <div class="pagination-container" id="paginationContainer" style="display: none;">
                                    <div class="pagination-info">
                                        <span id="paginationInfo">${getText('chatList.pagePrefix')} 1 ${getText('chatList.pageSuffix')}Ôºå${getText('chatList.totalPrefix')} 1 ${getText('chatList.totalSuffix')}</span>
                                    </div>
                                    <div class="pagination-controls">
                                        <button id="paginationPrev" class="pagination-btn" disabled>${getText('chatList.prev')}</button>
                                        <div class="pagination-pages" id="paginationPages"></div>
                                        <button id="paginationNext" class="pagination-btn">${getText('chatList.next')}</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="text-align: center; margin-top: 50px;">
                                <button class="btn" id="exportBtn" style="background: rgba(255,255,255,0.1); border: 1px solid var(--card-border);">
                                    <span>${getText('dashboard.exportBtn')}</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            };
            
            // ËØ≠Ë®ÄÂàáÊç¢ÂáΩÊï∞
            const switchLanguage = async (newLang) => {
                setLang(newLang);
                localStorage.setItem('appLanguage', newLang);
                // Êõ¥Êñ∞ HTML lang Â±ûÊÄß
                document.documentElement.lang = newLang;
                
                // Â¶ÇÊûúÂ∑≤ÁªèÂàÜÊûêÂÆåÊàêÔºåÈáçÊñ∞ÂàÜÊûê‰ª•Êõ¥Êñ∞ËØ≠Ë®Ä
                if (analysisData && window.analysisModule && window.analysisModule.reanalyzeWithLanguage) {
                    try {
                        const newVibeResult = await window.analysisModule.reanalyzeWithLanguage(newLang);
                        if (newVibeResult) {
                            // Êõ¥Êñ∞ÂàÜÊûêÊï∞ÊçÆ
                            setAnalysisData(prev => ({
                                ...prev,
                                vibeResult: newVibeResult
                            }));
                        }
                    } catch (error) {
                        console.error('ÈáçÊñ∞ÂàÜÊûêÂ§±Ë¥•:', error);
                    }
                }
                
                // Â¶ÇÊûúÊòØÂú®ÂÆåÊï¥Êä•ÂëäÈ°µÈù¢ÔºåÈáçÊñ∞ÂàõÂª∫ DOM Âπ∂Ê∏≤Êüì
                if (step === 'fullReport' && window.analysisModule && window.analysisModule.renderFullDashboard) {
                    setTimeout(() => {
                        // ÈáçÊñ∞ÂàõÂª∫ Dashboard DOMÔºà‰ΩøÁî®Êñ∞ËØ≠Ë®ÄÔºâ
                        recreateDashboardDOM(newLang);
                        
                        // ÈáçÊñ∞Ê∏≤Êüì Dashboard
                        setTimeout(() => {
                            window.analysisModule.renderFullDashboard();
                            // ÈáçÊñ∞Êõ¥Êñ∞ÊéíÂêçÂç°ÁâáÔºà‰ΩøÁî®Êñ∞ËØ≠Ë®ÄÔºâ
                            if (window.userRankings && window.updateRankingBadges) {
                                setTimeout(async () => {
                                    // Ê∏ÖÈô§ÁºìÂ≠òÔºåÂº∫Âà∂ÈáçÊñ∞Âä†ËΩΩ
                                    if (window.rankingDataCache) {
                                        Object.keys(window.rankingDataCache).forEach(key => {
                                            delete window.rankingDataCache[key];
                                        });
                                    }
                                    // ‰ΩøÁî®ÂÖ®Â±ÄÁöÑupdateRankingBadgesÂáΩÊï∞Êõ¥Êñ∞ÊéíÂêçÂç°Áâá
                                    await window.updateRankingBadges(window.userRankings, newLang);
                                }, 200);
                            }
                        }, 100);
                    }, 100);
                }
            };
            
            const [step, setStep] = useState('upload');
            const [logs, setLogs] = useState([]);
            const [analysisData, setAnalysisData] = useState(null);
            const [error, setError] = useState(null);
            const [isInitialized, setIsInitialized] = useState(false);
            const [totalTestUsers, setTotalTestUsers] = useState(0); // ‰ªé API Ëé∑ÂèñÔºå‰∏ç‰ΩøÁî®Á°¨ÁºñÁ†Å
            // ÂÆûÊó∂ÁªüËÆ°Êï∞ÊçÆÔºàÂÖ®ÈÉ®‰ªé Cloudflare API Ëé∑ÂèñÔºâ
            const [totalUsers, setTotalUsers] = useState(0); // ÂèóËôê‰∫∫Êï∞
            const [techRank, setTechRank] = useState(0); // ÊäÄÊúØÊéíÂêç
            const [unlockedCount, setUnlockedCount] = useState(0); // ‰∫∫Ê†ºËß£ÈîÅÊï∞
            const [isShareMode, setIsShareMode] = useState(false); // ÊòØÂê¶‰∏∫ÂàÜ‰∫´Êü•ÁúãÊ®°Âºè
            const [shareRankings, setShareRankings] = useState(null); // ÂàÜ‰∫´ÁöÑÊéíÂêçÊï∞ÊçÆ
            const folderInputRef = useRef(null);
            const fileInputRef = useRef(null);
            // Áî®‰∫é‰øùÂ≠òÂä®ÁîªÊâÄÈúÄÁöÑÊóßÂÄºÂíåÊñ∞ÂÄº
            const animationDataRef = useRef(null);
            
            // ÂàùÂßãÂåñÊó∂ËÆæÁΩÆ HTML lang Â±ûÊÄß
            useEffect(() => {
                document.documentElement.lang = lang;
                // Êõ¥Êñ∞È°µÈù¢Ê†áÈ¢ò
                const titleElement = document.getElementById('pageTitle');
                if (titleElement) {
                    titleElement.textContent = lang === 'en' ? 'Cursor Diagnostics' : 'Cursor Ë°å‰∏∫‰ΩìÊ£Ä - Vibe Coding';
                }
            }, [lang]);

            // Ë∑ØÁî±Ëß£ÊûêÈÄªËæëÔºöÊ£ÄÊü• URL Hash ‰∏≠ÁöÑÂàÜ‰∫´Êï∞ÊçÆ
            useEffect(() => {
                const hash = window.location.hash;
                if (hash && hash.startsWith('#share=')) {
                    try {
                        const base64String = hash.substring(7); // ÂéªÊéâ '#share='
                        const decodedString = decodeURIComponent(atob(base64String));
                        const shareData = JSON.parse(decodedString);
                        
                        console.log('[ÂàÜ‰∫´] Ê£ÄÊµãÂà∞ÂàÜ‰∫´ÈìæÊé•ÔºåÊï∞ÊçÆ:', shareData);
                        
                        // ËÆæÁΩÆÂàÜ‰∫´Ê®°Âºè
                        setIsShareMode(true);
                        setShareRankings(shareData);
                        
                        // Ê≥®ÂÖ•ÊéíÂêçÊï∞ÊçÆÂà∞ÂÖ®Â±ÄÂèòÈáè
                        if (shareData.rankings) {
                            window.userRankings = shareData.rankings;
                        }
                        
                        // Â¶ÇÊûúÊúâÂàÜÊûêÊï∞ÊçÆÔºåÂ≠òÂÇ®Âà∞ÂÖ®Â±ÄÂèòÈáè‰æõ analysisModule ‰ΩøÁî®
                        if (shareData.analysisData) {
                            if (shareData.analysisData.stats) {
                                window.shareModeStats = shareData.analysisData.stats;
                            }
                            if (shareData.analysisData.vibeResult) {
                                window.shareModeVibeResult = shareData.analysisData.vibeResult;
                            }
                        }
                        
                        // Á≠âÂæÖ analysisModule Âä†ËΩΩÂÆåÊàêÂêéÂÜçÊ∏≤Êüì
                        const checkAndRender = () => {
                            if (window.analysisModule && window.analysisModule.renderFullDashboard) {
                                // Áõ¥Êé•ËøõÂÖ• Dashboard
                                setStep('fullReport');
                                
                                // Âª∂ËøüÊ∏≤Êüì Dashboard
                                setTimeout(() => {
                                    const container = document.getElementById('fullReportContainer');
                                    if (container) {
                                        recreateDashboardDOM(lang);
                                        container.style.display = 'block';
                                        
                                        setTimeout(() => {
                                            const dashboardSection = container.querySelector('#dashboardSection');
                                            if (dashboardSection) {
                                                dashboardSection.classList.remove('hidden');
                                                dashboardSection.style.display = 'block';
                                            }
                                            
                                            // Â¶ÇÊûú analysisModule ÊúâÊï∞ÊçÆÔºå‰ΩøÁî®ÂàÜ‰∫´Êï∞ÊçÆË¶ÜÁõñ
                                            if (window.shareModeStats && window.analysisModule.updateGlobalStats) {
                                                window.analysisModule.updateGlobalStats(window.shareModeStats);
                                            }
                                            
                                            window.analysisModule.renderFullDashboard();
                                            
                                            // Êõ¥Êñ∞ÊéíÂêçÊòæÁ§∫
                                            setTimeout(async () => {
                                                if (shareData.rankings && window.updateRankingBadges) {
                                                    const currentLang = localStorage.getItem('appLanguage') || 'zh-CN';
                                                    await window.updateRankingBadges(shareData.rankings, currentLang);
                                                }
                                            }, 100);
                                        }, 500);
                                    }
                                }, 100);
                            } else {
                                // Â¶ÇÊûú analysisModule ËøòÊ≤°Âä†ËΩΩÔºåÁ≠âÂæÖ‰∏Ä‰∏ãÂÜçËØï
                                setTimeout(checkAndRender, 100);
                            }
                        };
                        
                        // ÂºÄÂßãÊ£ÄÊü•
                        checkAndRender();
                    } catch (error) {
                        console.error('[ÂàÜ‰∫´] Ëß£ÊûêÂàÜ‰∫´Êï∞ÊçÆÂ§±Ë¥•:', error);
                        alert('ÂàÜ‰∫´ÈìæÊé•Ê†ºÂºèÈîôËØØÔºåÊó†Ê≥ïÂä†ËΩΩÊï∞ÊçÆ');
                    }
                }
            }, []); // Âè™Âú®ÁªÑ‰ª∂ÊåÇËΩΩÊó∂ÊâßË°å‰∏ÄÊ¨°

            // Ê†ºÂºèÂåñÊï∞Â≠óÊòæÁ§∫
            const formatNumber = (num) => {
                if (typeof num !== 'number' || isNaN(num)) return '0';
                const currentLang = localStorage.getItem('appLanguage') || 'zh-CN';
                const isEn = currentLang === 'en';
                
                // Ëã±Êñá‰ΩøÁî®Ê†áÂáÜÊ†ºÂºèÔºöK, M, B, T
                if (isEn) {
                    if (num >= 1000000000000) {
                        return (num / 1000000000000).toFixed(1) + 'T';
                    }
                    if (num >= 1000000000) {
                        return (num / 1000000000).toFixed(1) + 'B';
                    }
                    if (num >= 1000000) {
                        return (num / 1000000).toFixed(1) + 'M';
                    }
                    if (num >= 1000) {
                        return (num / 1000).toFixed(1) + 'K';
                    }
                    return num.toString();
                }
                
                // ‰∏≠Êñá‰ΩøÁî®‰∏á„ÄÅ‰∫øÁ≠âÂçï‰Ωç
                if (num >= 1000000000000) {
                    return (num / 1000000000000).toFixed(1) + '‰∏á‰∫ø';
                }
                if (num >= 100000000000) {
                    return (num / 100000000000).toFixed(1) + 'ÂçÉ‰∫ø';
                }
                if (num >= 10000000000) {
                    return (num / 10000000000).toFixed(1) + 'Áôæ‰∫ø';
                }
                if (num >= 100000000) {
                    return (num / 100000000).toFixed(1) + '‰∫ø';
                }
                if (num >= 10000000) {
                    return (num / 10000000).toFixed(1) + 'ÂçÉ‰∏á';
                }
                if (num >= 1000000) {
                    return (num / 1000000).toFixed(1) + 'Áôæ‰∏á';
                }
                if (num >= 100000) {
                    return (num / 100000).toFixed(1) + 'ÂçÅ‰∏á';
                }
                if (num >= 10000) {
                    return (num / 10000).toFixed(1) + '‰∏á';
                }
                if (num >= 1000) {
                    return (num / 1000).toFixed(1) + 'K';
                }
                return num.toString();
            };

            // Êï∞Â≠óË∑≥Âä®Âä®ÁîªÊïàÊûúÂáΩÊï∞
            const animateNumberUpdate = (elementId, oldValue, newValue, formatFn) => {
                const element = document.getElementById(elementId);
                if (!element) {
                    console.warn(`[Âä®Áîª] Êú™ÊâæÂà∞ÂÖÉÁ¥†: ${elementId}`);
                    return;
                }

                // Ê∑ªÂä†Ë∑≥Âä®Âä®ÁîªÁ±ª
                element.classList.add('animate-pulse');
                
                // ËÆ°ÁÆóÂ∑ÆÂÄº
                const diff = newValue - oldValue;
                if (diff === 0) {
                    // Ê≤°ÊúâÂèòÂåñÔºåÁõ¥Êé•ÁßªÈô§Âä®ÁîªÁ±ª
                    setTimeout(() => {
                        element.classList.remove('animate-pulse');
                    }, 100);
                    return;
                }
                
                const duration = 800; // Âä®ÁîªÊåÅÁª≠Êó∂Èó¥ÔºàÊØ´ÁßíÔºâ
                const steps = 30; // Âä®ÁîªÊ≠•Êï∞
                const stepValue = diff / steps;
                const stepDuration = duration / steps;
                let currentStep = 0;
                const startTime = Date.now();
                
                const animate = () => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    // ‰ΩøÁî®ÁºìÂä®ÂáΩÊï∞Ôºàease-outÔºâ
                    const easeOut = 1 - Math.pow(1 - progress, 3);
                    const currentValue = Math.round(oldValue + diff * easeOut);
                    
                    element.textContent = formatFn(currentValue);
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        // Á°Æ‰øùÊúÄÁªàÂÄºÂáÜÁ°Æ
                        element.textContent = formatFn(newValue);
                        // ÁßªÈô§Âä®ÁîªÁ±ª
                        setTimeout(() => {
                            element.classList.remove('animate-pulse');
                        }, 100);
                        console.log(`[Âä®Áîª] ${elementId} Âä®ÁîªÂÆåÊàê: ${oldValue} -> ${newValue}`);
                    }
                };
                
                animate();
            };

            // È°µÈù¢Âä†ËΩΩÊó∂‰ªé API Ëé∑Âèñ"ÂÖ®ÁΩëÂèóËôê‰∫∫Êï∞"
            useEffect(() => {
                const fetchTotalUsers = async () => {
                    try {
                        const apiUrl = 'https://cursor-clinical-analysis.psterman.workers.dev/';
                        console.log('[React] ÂèëËµ∑ GET ËØ∑Ê±ÇËé∑ÂèñÂÖ®ÁΩëÂèóËôê‰∫∫Êï∞...');
                        
                        const response = await fetch(apiUrl, {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            mode: 'cors',
                            cache: 'no-cache',
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            const value = data.value || data.totalUsers || data.total || data.count || 0;
                            
                            console.log('[React] API ËøîÂõûÊï∞ÊçÆ:', data, 'Ëß£ÊûêÂêéÁöÑÂÄº:', value);
                            
                            if (value >= 0) {
                                // ÂèóËôê‰∫∫Êï∞Ôºö‰ΩøÁî® API ËøîÂõûÁöÑÂÆûÊó∂ËÆøÈóÆÊÄªÊï∞ÔºàÂÖÅËÆ∏ÊòæÁ§∫ 0Ôºâ
                                setTotalUsers(value);
                                setTotalTestUsers(value);
                                
                                // ÊäÄÊúØÊéíÂêçÔºöÊ†πÊçÆÊÄª‰∫∫Êï∞ÊåâÊØî‰æãÂä®ÊÄÅËÆ°ÁÆó (value * 0.6)
                                const calculatedRank = Math.floor(value * 0.6);
                                setTechRank(calculatedRank);
                                
                                // ‰∫∫Ê†ºÂ∫ìËß£ÈîÅÔºöÊ†πÊçÆÊÄª‰∫∫Êï∞ÊåâÊØî‰æãÂä®ÊÄÅËÆ°ÁÆó (value / 1000)%ÔºåÊúÄÂ§ß100%
                                const calculatedUnlocked = Math.min(100, parseFloat((value / 1000).toFixed(1)));
                                setUnlockedCount(calculatedUnlocked);
                                
                                // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®‰Ωú‰∏∫ fallback
                                localStorage.setItem('totalTestUsers', value.toString());
                                console.log('[React] Êï∞ÊçÆËé∑ÂèñÊàêÂäü:', {
                                    totalUsers: value,
                                    techRank: calculatedRank,
                                    unlockedCount: calculatedUnlocked
                                });
                            } else {
                                throw new Error('API ËøîÂõûÁöÑÂÄºÊó†Êïà');
                            }
                        } else {
                            throw new Error(`API ËØ∑Ê±ÇÂ§±Ë¥•ÔºåÁä∂ÊÄÅÁ†Å: ${response.status}`);
                        }
                    } catch (error) {
                        console.warn('[React] API ËØ∑Ê±ÇÂ§±Ë¥•Ôºå‰ΩøÁî® localStorage fallback:', error.message);
                        // ‰ΩøÁî® localStorage ‰Ωú‰∏∫ fallbackÔºàÂÖÅËÆ∏ÊòæÁ§∫ 0Ôºâ
                        const cached = parseInt(localStorage.getItem('totalTestUsers') || '0');
                        setTotalUsers(cached);
                        setTotalTestUsers(cached);
                        // Ê†πÊçÆÁºìÂ≠òÂÄºÂä®ÊÄÅËÆ°ÁÆó
                        setTechRank(Math.floor(cached * 0.6));
                        setUnlockedCount(Math.min(100, parseFloat((cached / 1000).toFixed(1))));
                        console.log('[React] ‰ΩøÁî®ÁºìÂ≠òÊï∞ÊçÆ:', {
                            totalUsers: cached,
                            techRank: Math.floor(cached * 0.6),
                            unlockedCount: Math.min(100, parseFloat((cached / 1000).toFixed(1)))
                        });
                    }
                };
                
                fetchTotalUsers();
            }, []);

            // ÂàùÂßãÂåñËß£ÊûêÂô®
            useEffect(() => {
                const init = async () => {
                    try {
                        console.log('Ê£ÄÊü• analysisModule:', window.analysisModule);
                        console.log('Ê£ÄÊü• analysisModuleLoading:', window.analysisModuleLoading);
                        console.log('Ê£ÄÊü• analysisModuleError:', window.analysisModuleError);
                        
                        // Á≠âÂæÖÊ®°ÂùóÂä†ËΩΩÔºàÊúÄÂ§öÁ≠âÂæÖ 5 ÁßíÔºâ
                        let retries = 0;
                        const maxRetries = 50; // 50 * 100ms = 5Áßí
                        
                        while (!window.analysisModule && retries < maxRetries) {
                            // Â¶ÇÊûúÊ®°ÂùóÂä†ËΩΩÂ§±Ë¥•ÔºåÁ´ãÂç≥ÈÄÄÂá∫
                            if (window.analysisModuleError) {
                                console.error('Ê®°ÂùóÂä†ËΩΩÂ§±Ë¥•:', window.analysisModuleError);
                                const errorMsg = window.analysisModuleError.message || t('dashboard.unknownError');
                                setError(`${t('upload.logs.initializingParser')}: ${errorMsg}Ôºå${lang === 'en' ? 'please refresh and try again' : 'ËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï'}`);
                                return;
                            }
                            
                            // Â¶ÇÊûúÊ®°ÂùóËøòÂú®Âä†ËΩΩ‰∏≠ÔºåÁªßÁª≠Á≠âÂæÖ
                            if (window.analysisModuleLoading !== false) {
                                await new Promise(resolve => setTimeout(resolve, 100));
                                retries++;
                            } else {
                                // Âä†ËΩΩÂÆåÊàê‰ΩÜÊ®°Âùó‰∏çÂ≠òÂú®ÔºåËØ¥ÊòéÂä†ËΩΩÂ§±Ë¥•
                                break;
                            }
                        }
                        
                        if (window.analysisModule) {
                            console.log('‚úÖ Ê®°ÂùóÂ∑≤Âä†ËΩΩÔºåÂàùÂßãÂåñËß£ÊûêÂô®...');
                            await window.analysisModule.initializeParser();
                            setIsInitialized(true);
                            setLogs(prev => [...prev, '> Ëß£ÊûêÂô®ÂàùÂßãÂåñÂÆåÊàê']);
                        } else {
                            console.error('‚ùå Ê®°ÂùóÂä†ËΩΩË∂ÖÊó∂ÊàñÂ§±Ë¥•');
                            const errorMsg = window.analysisModuleError 
                                ? 'Ê®°ÂùóÂä†ËΩΩÂ§±Ë¥•: ' + window.analysisModuleError.message
                                : 'Ê®°ÂùóÂä†ËΩΩË∂ÖÊó∂ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï';
                            setError(errorMsg);
                        }
                    } catch (err) {
                        console.error('ÂàùÂßãÂåñÂ§±Ë¥•:', err);
                        setError('ÂàùÂßãÂåñÂ§±Ë¥•: ' + err.message);
                    }
                };
                
                // ÁõëÂê¨Ê®°ÂùóÂä†ËΩΩÂ§±Ë¥•‰∫ã‰ª∂
                const handleLoadFailed = (event) => {
                    console.error('Êî∂Âà∞Ê®°ÂùóÂä†ËΩΩÂ§±Ë¥•‰∫ã‰ª∂:', event.detail);
                    const errorMsg = event.detail.error?.message || t('dashboard.unknownError');
                    setError(`${t('upload.logs.initializingParser')}: ${errorMsg}Ôºå${lang === 'en' ? 'please refresh and try again' : 'ËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï'}`);
                };
                window.addEventListener('analysisModuleLoadFailed', handleLoadFailed);
                
                init();
                
                // Ê∏ÖÁêÜ‰∫ã‰ª∂ÁõëÂê¨Âô®
                return () => {
                    window.removeEventListener('analysisModuleLoadFailed', handleLoadFailed);
                };
            }, []);

            // Â§ÑÁêÜÊñá‰ª∂ÈÄâÊã©
            const handleFileSelect = (type) => {
                console.log('handleFileSelect Ë¢´Ë∞ÉÁî®', type);
                console.log('folderInputRef.current:', folderInputRef.current);
                console.log('fileInputRef.current:', fileInputRef.current);
                
                if (type === 'folder') {
                    if (folderInputRef.current) {
                        console.log('Ëß¶ÂèëÊñá‰ª∂Â§πÈÄâÊã©');
                        folderInputRef.current.click();
                    } else {
                        console.error('folderInputRef.current ‰∏∫ null');
                    }
                } else {
                    if (fileInputRef.current) {
                        console.log('Ëß¶ÂèëÊñá‰ª∂ÈÄâÊã©');
                        fileInputRef.current.click();
                    } else {
                        console.error('fileInputRef.current ‰∏∫ null');
                    }
                }
            };

            // Â§ÑÁêÜÊñá‰ª∂‰∏ä‰º†
            const handleFileUpload = async (event, type) => {
                console.log('handleFileUpload Ë¢´Ë∞ÉÁî®', { type, files: event.target.files });
                
                const files = Array.from(event.target.files || []);
                console.log('Êñá‰ª∂ÂàóË°®:', files.map(f => ({ name: f.name, size: f.size })));
                
                if (files.length === 0) {
                    console.warn('Ê≤°ÊúâÈÄâÊã©Êñá‰ª∂');
                    return;
                }

                setError(null);
                setStep('analyzing');
                setLogs([`> ${t('upload.logs.startParsing')}`]);

                try {
                    // Ê£ÄÊü•Ê®°ÂùóÊòØÂê¶Âä†ËΩΩÔºåÂ¶ÇÊûúÊú™Âä†ËΩΩÂàôÁ≠âÂæÖ‰∏ÄÊÆµÊó∂Èó¥
                    if (!window.analysisModule) {
                        console.warn('Ê®°ÂùóÊú™Âä†ËΩΩÔºåÁ≠âÂæÖÂä†ËΩΩ...');
                        setLogs(prev => [...prev, `> ${t('upload.logs.waitingModule')}`]);
                        
                        // Á≠âÂæÖÊ®°ÂùóÂä†ËΩΩÔºàÊúÄÂ§öÁ≠âÂæÖ 3 ÁßíÔºâ
                        let retries = 0;
                        const maxRetries = 30; // 30 * 100ms = 3Áßí
                        
                        while (!window.analysisModule && retries < maxRetries) {
                            // Â¶ÇÊûúÊ®°ÂùóÂä†ËΩΩÂ§±Ë¥•ÔºåÁ´ãÂç≥ÈÄÄÂá∫
                            if (window.analysisModuleError) {
                                const errorMsg = window.analysisModuleError.message || t('dashboard.unknownError');
                                throw new Error(`${t('upload.logs.initializingParser')}: ${errorMsg}Ôºå${lang === 'en' ? 'please refresh and try again' : 'ËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï'}`);
                            }
                            
                            // Â¶ÇÊûúÊ®°ÂùóËøòÂú®Âä†ËΩΩ‰∏≠ÔºåÁªßÁª≠Á≠âÂæÖ
                            if (window.analysisModuleLoading !== false) {
                                await new Promise(resolve => setTimeout(resolve, 100));
                                retries++;
                            } else {
                                // Âä†ËΩΩÂÆåÊàê‰ΩÜÊ®°Âùó‰∏çÂ≠òÂú®ÔºåËØ¥ÊòéÂä†ËΩΩÂ§±Ë¥•
                                break;
                            }
                        }
                        
                        if (!window.analysisModule) {
                            const errorMsg = window.analysisModuleError 
                                ? 'ÂàÜÊûêÊ®°ÂùóÂä†ËΩΩÂ§±Ë¥•: ' + window.analysisModuleError.message
                                : 'ÂàÜÊûêÊ®°ÂùóÂä†ËΩΩË∂ÖÊó∂';
                            throw new Error(errorMsg + 'ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
                        }
                        
                        console.log('‚úÖ Ê®°ÂùóÂ∑≤Âä†ËΩΩÔºåÁªßÁª≠Â§ÑÁêÜÊñá‰ª∂');
                        setLogs(prev => [...prev, `> ${t('upload.logs.parserReady')}`]);
                    }

                    if (!isInitialized) {
                        setLogs(prev => [...prev, `> ${t('upload.logs.initializingParser')}`]);
                        await window.analysisModule.initializeParser();
                        setIsInitialized(true);
                    }

                    // Ë∞ÉÁî® main.js ÁöÑÂ§ÑÁêÜÂáΩÊï∞
                    console.log('Ë∞ÉÁî® processFiles...');
                    await window.analysisModule.processFiles(files, type, {
                        onLog: (log) => {
                            console.log('onLog:', log);
                            setLogs(prev => [...prev, log]);
                        },
                        onProgress: (current, total, fileName) => {
                            console.log('onProgress:', { current, total, fileName });
                            setLogs(prev => [...prev, `> ${t('upload.logs.processingProgress').replace('{current}', current).replace('{total}', total).replace('{fileName}', fileName)}`]);
                        },
                        onComplete: (data) => {
                            console.log('onComplete:', data);
                            setAnalysisData(data);
                            setLogs(prev => [...prev, `> ${t('upload.logs.analysisComplete')}`]);
                            setTimeout(() => {
                                setStep('preview');
                            }, 500);
                        },
                        onError: (err) => {
                            console.error('onError:', err);
                            setError(err.message || 'Â§ÑÁêÜÂ§±Ë¥•');
                            setStep('upload');
                        }
                    });
                } catch (err) {
                    console.error('Â§ÑÁêÜÂ§±Ë¥•:', err);
                    setError(err.message || 'Â§ÑÁêÜÂ§±Ë¥•');
                    setStep('upload');
                }
            };


            // ËÆ°ÁÆóÊéíÂêçÔºàÂü∫‰∫é"ËØ∑"ÁöÑÊ¨°Êï∞ÔºåÁÆÄÂåñÁâàÔºâ
            // TODO: Áî®Êà∑Á®çÂêé‰ºö‰øÆÊîπÊ≠§ÂáΩÊï∞ÁöÑÂèÇÊï∞
            const calculateRank = (qingCount) => {
                // ÁÆÄÂåñËÆ°ÁÆóÔºöÂÅáËÆæÂπ≥ÂùáÁî®Êà∑ËØ¥"ËØ∑"50Ê¨°ÔºåË∂ÖËøáË∂äÂ§öÊéíÂêçË∂äÈ´ò
                const base = 50;
                const ratio = qingCount / base;
                return Math.min(99, Math.max(1, Math.round(ratio * 50)));
            };

            // ËÆ°ÁÆóÂØπËØùÂ§©Êï∞Ôºà‰ªéÊúÄÊó©Êñá‰ª∂Êó∂Èó¥ËÆ°ÁÆóÔºâ
            const calculateUsageDays = (stats) => {
                if (!stats || !stats.earliestFileTime) {
                    return 0;
                }
                const now = Date.now();
                const earliest = stats.earliestFileTime;
                const diffMs = now - earliest;
                return Math.floor(diffMs / (1000 * 60 * 60 * 24));
            };

            // ËøõÂÖ•ÂÆåÊï¥Êä•Âëä
            const showFullReport = async () => {
                console.log('showFullReport Ë¢´Ë∞ÉÁî®ÔºåÂèëËµ∑ POST ËØ∑Ê±ÇÂ¢ûÂä†ËÆ°Êï∞ÂÄºÂπ∂‰∏ä‰º†ÁªüËÆ°Êï∞ÊçÆ...');
                
                // ‰øùÂ≠òÂΩìÂâçÂÄºÔºåÁî®‰∫éÂä®ÁîªÊïàÊûú
                const oldTotalUsers = totalUsers;
                const oldTechRank = techRank;
                const oldUnlockedCount = unlockedCount;
                
                // Ëé∑ÂèñÂΩìÂâçÁî®Êà∑ÁöÑÁªüËÆ°Êï∞ÊçÆ
                const stats = window.analysisModule?.getGlobalStats();
                const usageDays = calculateUsageDays(stats);
                
                // ÂáÜÂ§á‰∏ä‰º†ÁªüËÆ°Êï∞ÊçÆ
                const userStats = {
                    qingCount: stats?.qingCount || 0,           // ËµõÂçöÁ£ïÂ§¥Ê¨°Êï∞
                    buCount: stats?.buCount || 0,                // Áî≤ÊñπÁà∏Áà∏‰∏äË∫´
                    userMessages: stats?.userMessages || 0,      // Ë∞ÉÊàèAIÊ¨°Êï∞
                    totalUserChars: stats?.userBehaviorStats?.totalUserChars || 0,  // Â∫üËØùÊñáÂ≠¶ËæìÂá∫
                    avgUserMessageLength: stats?.userBehaviorStats?.avgUserMessageLength || 0,  // Âπ≥ÂùáÂêπÊ∞¥ÈïøÂ∫¶
                    totalConversations: stats?.totalConversations || 0,  // Cursor‰∏äÂ≤óÂ§©Êï∞ÔºàÂØπËØùÊï∞Ôºâ
                    usageDays: usageDays,                        // ‰ΩøÁî®Â§©Êï∞
                    timestamp: Date.now()
                };
                
                console.log('[React] ÂáÜÂ§á‰∏ä‰º†ÁªüËÆ°Êï∞ÊçÆ:', userStats);
                
                // Âú®Áî®Êà∑ÁÇπÂáªÁîüÊàêÊä•ÂëäÊó∂ÔºåÂèëËµ∑ POST ËØ∑Ê±ÇÂ¢ûÂä†ËÆ°Êï∞ÂÄºÂπ∂‰∏ä‰º†ÁªüËÆ°Êï∞ÊçÆ
                try {
                    const apiUrl = 'https://cursor-clinical-analysis.psterman.workers.dev/';
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        mode: 'cors',
                        body: JSON.stringify({
                            action: 'submit_stats',
                            stats: userStats,
                            timestamp: Date.now(),
                        }),
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        const newCount = data.value || data.totalUsers || data.total || data.count || 0;
                        
                        // Êõ¥Êñ∞ÊâÄÊúâÁõ∏ÂÖ≥Áä∂ÊÄÅ
                        setTotalUsers(newCount >= 0 ? newCount : 0);
                        setTotalTestUsers(newCount >= 0 ? newCount : 0);
                        
                        // Ê†πÊçÆÊñ∞ÁöÑÊÄª‰∫∫Êï∞Âä®ÊÄÅËÆ°ÁÆóÊäÄÊúØÊéíÂêçÂíå‰∫∫Ê†ºÂ∫ìËß£ÈîÅ
                        const calculatedRank = Math.floor(newCount * 0.6);
                        setTechRank(calculatedRank);
                        
                        const calculatedUnlocked = Math.min(100, parseFloat((newCount / 1000).toFixed(1)));
                        setUnlockedCount(calculatedUnlocked);
                        
                        // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®‰Ωú‰∏∫ fallback
                        localStorage.setItem('totalTestUsers', newCount.toString());
                        
                        // ‰øùÂ≠òÊéíÂêçÊï∞ÊçÆÂà∞Áä∂ÊÄÅÔºàÂ¶ÇÊûú API ËøîÂõû‰∫ÜÊéíÂêçÔºâ
                        if (data.rankings) {
                            window.userRankings = data.rankings;
                            console.log('[React] ‚úÖ ÊéíÂêçÊï∞ÊçÆÂ∑≤‰øùÂ≠ò:', data.rankings);
                        } else {
                            console.warn('[React] ‚ö†Ô∏è API Êú™ËøîÂõûÊéíÂêçÊï∞ÊçÆÔºÅ');
                            console.warn('[React] ÂèØËÉΩÂéüÂõ†Ôºö');
                            console.warn('1. Cloudflare Worker ‰ª£Á†ÅÊú™Êõ¥Êñ∞ÔºàËØ∑ÂèÇËÄÉ CLOUDFLARE_WORKER_RANKING.mdÔºâ');
                            console.warn('2. Worker ‰ª£Á†Å‰∏çÊîØÊåÅ submit_stats Âä®‰Ωú');
                            console.warn('3. Worker ‰ª£Á†ÅÊúâÈîôËØØÔºåËØ∑Ê£ÄÊü• Cloudflare Dashboard Êó•Âøó');
                            console.warn('ÂΩìÂâç API ÂìçÂ∫î:', data);
                        }
                        
                        console.log('[React] POST ËØ∑Ê±ÇÊàêÂäüÔºåËÆ°Êï∞ÂÄºÂíåÊéíÂêçÂ∑≤Êõ¥Êñ∞:', {
                            totalUsers: newCount,
                            techRank: calculatedRank,
                            unlockedCount: calculatedUnlocked,
                            rankings: data.rankings,
                            hasRankings: !!data.rankings
                        });
                        
                        // ‰øùÂ≠òÂä®ÁîªÊï∞ÊçÆÂà∞ refÔºåÁ≠âÂæÖ Dashboard Ê∏≤ÊüìÂÆåÊàêÂêéËß¶Âèë
                        animationDataRef.current = {
                            totalUsers: { old: oldTotalUsers, new: newCount },
                            techRank: { old: oldTechRank, new: calculatedRank },
                            unlockedCount: { old: oldUnlockedCount, new: calculatedUnlocked }
                        };
                    } else {
                        console.warn('[React] POST ËØ∑Ê±ÇÂ§±Ë¥•ÔºåÁä∂ÊÄÅÁ†Å:', response.status);
                        // POST Â§±Ë¥•Êó∂ÔºåÂ∞ùËØï‰ªé localStorage Ëé∑ÂèñÊúÄÊñ∞ÂÄº
                        const cached = parseInt(localStorage.getItem('totalTestUsers') || '0');
                        setTotalUsers(cached >= 0 ? cached : 0);
                        setTotalTestUsers(cached >= 0 ? cached : 0);
                        setTechRank(Math.floor(cached * 0.6));
                        setUnlockedCount(Math.min(100, parseFloat((cached / 1000).toFixed(1))));
                    }
                } catch (error) {
                    console.warn('[React] POST ËØ∑Ê±ÇÂºÇÂ∏∏Ôºå‰ΩøÁî® localStorage fallback:', error.message);
                    // ËØ∑Ê±ÇÂºÇÂ∏∏Êó∂Ôºå‰ΩøÁî® localStorage ‰Ωú‰∏∫ fallback
                    const cached = parseInt(localStorage.getItem('totalTestUsers') || '0');
                    setTotalUsers(cached >= 0 ? cached : 0);
                    setTotalTestUsers(cached >= 0 ? cached : 0);
                    setTechRank(Math.floor(cached * 0.6));
                    setUnlockedCount(Math.min(100, parseFloat((cached / 1000).toFixed(1))));
                }
                
                setStep('fullReport');
                // Âª∂ËøüÊ∏≤ÊüìÔºåÁ°Æ‰øù DOM Â∑≤Êõ¥Êñ∞
                setTimeout(() => {
                    const container = document.getElementById('fullReportContainer');
                    if (container && window.analysisModule) {
                        console.log('ÂàõÂª∫ Dashboard DOM...');
                        // ‰ΩøÁî® recreateDashboardDOM ÂáΩÊï∞ÂàõÂª∫ Dashboard DOMÔºà‰ΩøÁî®ÂΩìÂâçËØ≠Ë®ÄÔºâ
                        recreateDashboardDOM(lang);
                        // ÊòæÁ§∫ÂÆπÂô®
                        container.style.display = 'block';
                        
                        // Á≠âÂæÖ DOM ÂÆåÂÖ®Ê∏≤ÊüìÂêéÂÜçË∞ÉÁî®Ê∏≤ÊüìÂáΩÊï∞
                        setTimeout(() => {
                            console.log('ÂºÄÂßãÊ∏≤Êüì Dashboard...');
                            // ÊòæÁ§∫ Dashboard
                            const dashboardSection = container.querySelector('#dashboardSection');
                            if (dashboardSection) {
                                dashboardSection.classList.remove('hidden');
                                dashboardSection.style.display = 'block';
                            }
                            
                            // Á°Æ‰øùÊï∞ÊçÆÂ∑≤ÂáÜÂ§áÂ•Ω
                            const stats = window.analysisModule.getGlobalStats();
                            const vibeResult = window.analysisModule.getVibeResult();
                            console.log('Êï∞ÊçÆÁä∂ÊÄÅ:', {
                                hasStats: !!stats,
                                hasVibeResult: !!vibeResult
                            });
                            
                            // Ê∏≤ÊüìÂÆåÊï¥ Dashboard
                            try {
                                window.analysisModule.renderFullDashboard();
                                console.log('Dashboard Ê∏≤ÊüìÂÆåÊàê');
                                
                                // Âª∂ËøüÊõ¥Êñ∞ÊéíÂêçÊòæÁ§∫ÔºàÁ°Æ‰øù DOM ÂÖÉÁ¥†Â∑≤ÂàõÂª∫Ôºâ
                                setTimeout(async () => {
                                    if (window.userRankings) {
                                        const currentLang = localStorage.getItem('appLanguage') || 'zh-CN';
                                        await updateRankingBadges(window.userRankings, currentLang);
                                        console.log('[React] ‚úÖ ÊéíÂêçÂæΩÁ´†Â∑≤Êõ¥Êñ∞:', window.userRankings);
                                    } else {
                                        console.warn('[React] ‚ö†Ô∏è Êú™ÊâæÂà∞ÊéíÂêçÊï∞ÊçÆÔºÅ');
                                        console.warn('[React] ËØ∑Ê£ÄÊü•Ôºö');
                                        console.warn('1. ÊòØÂê¶Â∑≤Êõ¥Êñ∞ Cloudflare Worker ‰ª£Á†ÅÔºàÂèÇËÄÉ CLOUDFLARE_WORKER_RANKING.mdÔºâ');
                                        console.warn('2. ÊµèËßàÂô®ÊéßÂà∂Âè∞ÊòØÂê¶Êúâ API ÈîôËØØ');
                                        console.warn('3. ËøêË°å RANKING_DEBUG.md ‰∏≠ÁöÑË∞ÉËØï‰ª£Á†Å');
                                    }
                                }, 100);
                                
                            // Á´ãÂç≥‰ΩøÁî®ÂΩìÂâçÁä∂ÊÄÅÂÄºÊõ¥Êñ∞ÊòæÁ§∫Ôºà‰ΩøÁî® formatNumberÔºâ
                            const formatNumberLocal = (num) => {
                                if (typeof num !== 'number' || isNaN(num)) return '0';
                                const currentLang = localStorage.getItem('appLanguage') || 'zh-CN';
                                const isEn = currentLang === 'en';
                                
                                // Ëã±Êñá‰ΩøÁî®Ê†áÂáÜÊ†ºÂºèÔºöK, M, B, T
                                if (isEn) {
                                    if (num >= 1000000000000) {
                                        return (num / 1000000000000).toFixed(1) + 'T';
                                    }
                                    if (num >= 1000000000) {
                                        return (num / 1000000000).toFixed(1) + 'B';
                                    }
                                    if (num >= 1000000) {
                                        return (num / 1000000).toFixed(1) + 'M';
                                    }
                                    if (num >= 1000) {
                                        return (num / 1000).toFixed(1) + 'K';
                                    }
                                    return num.toString();
                                }
                                
                                // ‰∏≠Êñá‰ΩøÁî®‰∏á„ÄÅ‰∫øÁ≠âÂçï‰Ωç
                                if (num >= 1000000000000) {
                                    return (num / 1000000000000).toFixed(1) + '‰∏á‰∫ø';
                                }
                                if (num >= 100000000000) {
                                    return (num / 100000000000).toFixed(1) + 'ÂçÉ‰∫ø';
                                }
                                if (num >= 10000000000) {
                                    return (num / 10000000000).toFixed(1) + 'Áôæ‰∫ø';
                                }
                                if (num >= 100000000) {
                                    return (num / 100000000).toFixed(1) + '‰∫ø';
                                }
                                if (num >= 10000000) {
                                    return (num / 10000000).toFixed(1) + 'ÂçÉ‰∏á';
                                }
                                if (num >= 1000000) {
                                    return (num / 1000000).toFixed(1) + 'Áôæ‰∏á';
                                }
                                if (num >= 100000) {
                                    return (num / 100000).toFixed(1) + 'ÂçÅ‰∏á';
                                }
                                if (num >= 10000) {
                                    return (num / 10000).toFixed(1) + '‰∏á';
                                }
                                if (num >= 1000) {
                                    return (num / 1000).toFixed(1) + 'K';
                                }
                                return num.toString();
                            };
                                
                                const totalUsersEl = document.getElementById('totalTestUsers');
                                const techRankEl = document.getElementById('techRank');
                                const personalityUnlockEl = document.getElementById('personalityUnlock');
                                
                                if (totalUsersEl && totalUsers >= 0) {
                                    totalUsersEl.textContent = formatNumberLocal(totalUsers);
                                }
                                if (techRankEl && techRank >= 0) {
                                    techRankEl.textContent = formatNumberLocal(techRank);
                                }
                                if (personalityUnlockEl && unlockedCount >= 0) {
                                    personalityUnlockEl.textContent = unlockedCount.toFixed(1) + '%';
                                }
                                
                                // Ê£ÄÊü•ÊòØÂê¶ÊúâÂæÖÊâßË°åÁöÑÂä®ÁîªÊï∞ÊçÆÔºàÊù•Ëá™ POST ËØ∑Ê±ÇÔºâ
                                if (animationDataRef.current) {
                                    const animData = animationDataRef.current;
                                    console.log('[Âä®Áîª] ÂºÄÂßãÊâßË°åÊï∞Â≠óË∑≥Âä®Âä®Áîª:', animData);
                                    
                                    // Êõ¥Êñ∞ÂÖ®ÁΩëÂèóËôê‰∫∫Êï∞ÔºåÂ∏¶Ë∑≥Âä®ÊïàÊûú
                                    if (animData.totalUsers.old !== animData.totalUsers.new) {
                                        animateNumberUpdate('totalTestUsers', animData.totalUsers.old, animData.totalUsers.new, formatNumberLocal);
                                    }
                                    
                                    // Êõ¥Êñ∞ÊäÄÊúØÊéíÂêçÔºåÂ∏¶Ë∑≥Âä®ÊïàÊûú
                                    if (animData.techRank.old !== animData.techRank.new) {
                                        animateNumberUpdate('techRank', animData.techRank.old, animData.techRank.new, formatNumberLocal);
                                    }
                                    
                                    // Êõ¥Êñ∞‰∫∫Ê†ºÂ∫ìËß£ÈîÅÔºåÂ∏¶Ë∑≥Âä®ÊïàÊûú
                                    if (animData.unlockedCount.old !== animData.unlockedCount.new) {
                                        const animatePercentage = (elementId, oldVal, newVal) => {
                                            const element = document.getElementById(elementId);
                                            if (!element) return;
                                            
                                            element.classList.add('animate-pulse');
                                            const diff = newVal - oldVal;
                                            const duration = 800;
                                            const steps = 30;
                                            const stepValue = diff / steps;
                                            let currentStep = 0;
                                            
                                            const animate = () => {
                                                if (currentStep < steps) {
                                                    const currentValue = oldVal + stepValue * currentStep;
                                                    element.textContent = currentValue.toFixed(1) + '%';
                                                    currentStep++;
                                                    requestAnimationFrame(() => {
                                                        setTimeout(animate, duration / steps);
                                                    });
                                                } else {
                                                    element.textContent = newVal.toFixed(1) + '%';
                                                    setTimeout(() => {
                                                        element.classList.remove('animate-pulse');
                                                    }, 100);
                                                }
                                            };
                                            
                                            animate();
                                        };
                                        
                                        animatePercentage('personalityUnlock', animData.unlockedCount.old, animData.unlockedCount.new);
                                    }
                                    
                                    // Ê∏ÖÁ©∫Âä®ÁîªÊï∞ÊçÆ
                                    animationDataRef.current = null;
                                }
                            } catch (error) {
                                console.error('Ê∏≤Êüì Dashboard Â§±Ë¥•:', error);
                            }
                            
                            // Âä†ËΩΩÊéíÂêçJSONÊï∞ÊçÆ
                            // Â∞ÜÁºìÂ≠òÊö¥Èú≤Âà∞ÂÖ®Â±ÄÔºå‰ª•‰æøÂú®ËØ≠Ë®ÄÂàáÊç¢Êó∂Ê∏ÖÈô§
                            if (!window.rankingDataCache) {
                                window.rankingDataCache = {};
                            }
                            const rankingDataCache = window.rankingDataCache;
                            const loadRankingData = async (jsonFile, lang = 'zh-CN') => {
                                // Ê†πÊçÆËØ≠Ë®ÄÁîüÊàêÁºìÂ≠òÈîÆ
                                const cacheKey = `${jsonFile}_${lang}`;
                                if (rankingDataCache[cacheKey]) {
                                    return rankingDataCache[cacheKey];
                                }
                                try {
                                    // Â∞ùËØïÂä†ËΩΩÂØπÂ∫îËØ≠Ë®ÄÁöÑJSONÊñá‰ª∂
                                    let targetFile = jsonFile;
                                    if (lang === 'en') {
                                        // Ëã±ÊñáÁâà‰ΩøÁî®*2.jsonÊ†ºÂºèÔºàÂ¶Çplease2.json, word2.jsonÁ≠âÔºâ
                                        const enFile = jsonFile.replace('.json', '2.json');
                                        try {
                                            const enResponse = await fetch(`src/${enFile}`);
                                            if (enResponse.ok) {
                                                targetFile = enFile;
                                            } else {
                                                // Ëã±ÊñáÊñá‰ª∂‰∏çÂ≠òÂú®Ôºå‰ΩøÁî®‰∏≠ÊñáÁâàÊú¨
                                                console.warn(`Ëã±ÊñáÁâàÊñá‰ª∂ ${enFile} ‰∏çÂ≠òÂú®ÔºàHTTP ${enResponse.status}ÔºâÔºå‰ΩøÁî®‰∏≠ÊñáÁâàÊú¨`);
                                            }
                                        } catch (e) {
                                            // Ëã±ÊñáÊñá‰ª∂‰∏çÂ≠òÂú®Ôºå‰ΩøÁî®‰∏≠ÊñáÁâàÊú¨
                                            console.warn(`Ëã±ÊñáÁâàÊñá‰ª∂ ${enFile} Âä†ËΩΩÂ§±Ë¥•Ôºå‰ΩøÁî®‰∏≠ÊñáÁâàÊú¨:`, e.message);
                                        }
                                    }
                                    const response = await fetch(`src/${targetFile}`);
                                    if (!response.ok) {
                                        throw new Error(`HTTP error! status: ${response.status}`);
                                    }
                                    // Ëã±ÊñáÁâàJSONÊñá‰ª∂ÂèØËÉΩÂåÖÂê´Â§ö‰∏™JSONÂØπË±°ÔºåÈúÄË¶ÅÁâπÊÆäÂ§ÑÁêÜ
                                    const text = await response.text();
                                    let data;
                                    if (lang === 'en' && targetFile.endsWith('2.json')) {
                                        // Ëã±ÊñáÁâàÊñá‰ª∂Ôºà*2.jsonÔºâÂèØËÉΩÂåÖÂê´Â§ö‰∏™Áã¨Á´ãÁöÑJSONÂØπË±°
                                        // ÂÖàÂ∞ùËØï‰Ωú‰∏∫Âçï‰∏™JSONËß£Êûê
                                        try {
                                            data = JSON.parse(text);
                                            // Â¶ÇÊûúËß£ÊûêÊàêÂäü‰ΩÜÊ≤°ÊúâsegmentsÂ≠óÊÆµÔºåËØ¥ÊòéÊòØÂçï‰∏™ÂØπË±°ÔºåÈúÄË¶ÅËΩ¨Êç¢‰∏∫segmentsÊï∞ÁªÑ
                                            if (!data.segments && !data.levels) {
                                                data = { segments: [data], isEnglishFormat: true };
                                            } else if (data.segments) {
                                                data.isEnglishFormat = true;
                                            }
                                        } catch (e) {
                                            // Â¶ÇÊûúÂ§±Ë¥•ÔºåÂ∞ùËØïÂàÜÂâ≤Â§ö‰∏™JSONÂØπË±°
                                            // Êü•ÊâæÊâÄÊúâÁã¨Á´ãÁöÑJSONÂØπË±°Ôºà‰ª•{ÂºÄÂ§¥Ôºå‰ª•}ÁªìÂ∞æÔºâ
                                            const segments = [];
                                            let braceCount = 0;
                                            let startPos = -1;
                                            
                                            for (let i = 0; i < text.length; i++) {
                                                if (text[i] === '{') {
                                                    if (braceCount === 0) startPos = i;
                                                    braceCount++;
                                                } else if (text[i] === '}') {
                                                    braceCount--;
                                                    if (braceCount === 0 && startPos !== -1) {
                                                        // ÊâæÂà∞‰∏Ä‰∏™ÂÆåÊï¥ÁöÑJSONÂØπË±°
                                                        try {
                                                            const jsonStr = text.substring(startPos, i + 1);
                                                            const obj = JSON.parse(jsonStr);
                                                            segments.push(obj);
                                                        } catch (parseError) {
                                                            console.warn('Ëß£ÊûêJSONÂØπË±°Â§±Ë¥•:', parseError);
                                                        }
                                                        startPos = -1;
                                                    }
                                                }
                                            }
                                            
                                            if (segments.length > 0) {
                                                data = { segments: segments, isEnglishFormat: true };
                                            } else {
                                                // Â¶ÇÊûúËã±ÊñáÁâàËß£ÊûêÂ§±Ë¥•ÔºåÂ∞ùËØïÂä†ËΩΩ‰∏≠ÊñáÁâàÊú¨‰Ωú‰∏∫ÂõûÈÄÄ
                                                console.warn(`Ëã±ÊñáÁâà ${targetFile} Ëß£ÊûêÂ§±Ë¥•ÔºåÂ∞ùËØïÂä†ËΩΩ‰∏≠ÊñáÁâàÊú¨`);
                                                const zhFile = jsonFile; // ‰ΩøÁî®ÂéüÂßãÁöÑ‰∏≠ÊñáÊñá‰ª∂Âêç
                                                try {
                                                    const zhResponse = await fetch(`src/${zhFile}`);
                                                    if (zhResponse.ok) {
                                                        const zhText = await zhResponse.text();
                                                        data = JSON.parse(zhText);
                                                        console.log(`Â∑≤ÂõûÈÄÄÂà∞‰∏≠ÊñáÁâàÊú¨: ${zhFile}`);
                                                    } else {
                                                        throw new Error(`Êó†Ê≥ïÂä†ËΩΩ‰∏≠ÊñáÁâàÊú¨ ${zhFile}`);
                                                    }
                                                } catch (zhError) {
                                                    throw new Error(`Êó†Ê≥ïËß£ÊûêJSONÊñá‰ª∂ÔºàËã±ÊñáÁâàÂíå‰∏≠ÊñáÁâàÈÉΩÂ§±Ë¥•Ôºâ`);
                                                }
                                            }
                                        }
                                    } else {
                                        data = JSON.parse(text);
                                    }
                                    rankingDataCache[cacheKey] = data;
                                    return data;
                                } catch (error) {
                                    console.error(`Âä†ËΩΩ ${jsonFile} Â§±Ë¥•:`, error);
                                    return null;
                                }
                            };
                            
                            // Ê†πÊçÆÊéíÂêçÂåπÈÖçÂØπÂ∫îÁöÑlevelÂíåcomment
                            const getRankingComment = (data, rank, total, lang = 'zh-CN') => {
                                if (!data || rank === null || rank === undefined || total <= 0) {
                                    return null;
                                }
                                
                                const percent = ((total - rank + 1) / total * 100);
                                const rankPercent = (rank / total) * 100;
                                
                                // Â§ÑÁêÜËã±ÊñáÁâàJSONÊ†ºÂºèÔºàÊúâsegmentsÊï∞ÁªÑÊàñisEnglishFormatÊ†áÂøóÔºâ
                                if (data.isEnglishFormat && data.segments) {
                                    // Ëã±ÊñáÁâàÔºöÊ†πÊçÆrankÂåπÈÖçsegment
                                    for (const segment of data.segments) {
                                        if (!segment.segment || !segment.comments) continue;
                                        
                                        // Ëß£ÊûêsegmentÊ†ºÂºèÔºåÂ¶Ç"Rank 1-33"Êàñ"Rank 68-100"
                                        const segmentMatch = segment.segment.match(/Rank\s+(\d+)-(\d+)/);
                                        if (segmentMatch) {
                                            const minRank = parseInt(segmentMatch[1]);
                                            const maxRank = parseInt(segmentMatch[2]);
                                            if (rank >= minRank && rank <= maxRank) {
                                                // ÊâæÂà∞ÂåπÈÖçÁöÑsegmentÔºåÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™comment
                                                const randomComment = segment.comments[Math.floor(Math.random() * segment.comments.length)];
                                                return {
                                                    title: randomComment.title,
                                                    content: randomComment.content,
                                                    label: segment.segment
                                                };
                                            }
                                        }
                                    }
                                    return null;
                                }
                                
                                // Â§ÑÁêÜ‰∏≠ÊñáÁâàJSONÊ†ºÂºèÔºàÊúâlevelsÊï∞ÁªÑÔºâ
                                if (!data.levels) {
                                    return null;
                                }
                                
                                // ÈÅçÂéÜlevelsÔºåÊâæÂà∞ÂåπÈÖçÁöÑlevel
                                for (const level of data.levels) {
                                    const range = level.range;
                                    
                                    // Â§ÑÁêÜ‰∏çÂêåÁöÑrangeÊ†ºÂºè
                                    let matched = false;
                                    
                                    // Â§ÑÁêÜ "TOP 81-100" Ê†ºÂºèÔºàplease.jsonÔºâ
                                    if (range.startsWith('TOP ')) {
                                        const rangeStr = range.replace('TOP ', '');
                                        const [minPercent, maxPercent] = rangeStr.split('-').map(s => parseFloat(s.trim()));
                                        if (percent >= minPercent && percent <= maxPercent) {
                                            matched = true;
                                        }
                                    }
                                    // Â§ÑÁêÜ "1-10", "11-30" Á≠âÊ†ºÂºèÔºàno.json, ai.jsonÔºâ
                                    else if (/^\d+-\d+$/.test(range)) {
                                        const [minRank, maxRank] = range.split('-').map(s => parseInt(s.trim()));
                                        if (rank >= minRank && rank <= maxRank) {
                                            matched = true;
                                        }
                                    }
                                    // Â§ÑÁêÜ "91-100+" Ê†ºÂºèÔºàno.jsonÔºâ
                                    else if (/^\d+-\d+\+$/.test(range)) {
                                        const [minRank] = range.replace('+', '').split('-').map(s => parseInt(s.trim()));
                                        if (rank >= minRank) {
                                            matched = true;
                                        }
                                    }
                                    // Â§ÑÁêÜ "201+" Ê†ºÂºèÔºàai.jsonÔºâ
                                    else if (/^\d+\+$/.test(range)) {
                                        const minRank = parseInt(range.replace('+', ''));
                                        if (rank >= minRank) {
                                            matched = true;
                                        }
                                    }
                                    // Â§ÑÁêÜ "1-7Â§©", "8-30Â§©" Á≠âÊ†ºÂºèÔºàday.jsonÔºâ
                                    else if (range.includes('Â§©')) {
                                        // Ê†πÊçÆÊéíÂêçÁôæÂàÜÊØîÂåπÈÖçÔºöÊéíÂêçË∂äÈù†ÂâçÔºàrankË∂äÂ∞èÔºâÔºåÂ§©Êï∞Ë∂äÂ§ö
                                        // levelsÊï∞ÁªÑ‰ªé‰ΩéÂà∞È´òÊéíÂàóÔºåÊâÄ‰ª•ÈúÄË¶ÅÂèçÂêëÂåπÈÖç
                                        const levelIndex = data.levels.indexOf(level);
                                        const totalLevels = data.levels.length;
                                        const segmentSize = 100 / totalLevels;
                                        
                                        if (range === '181+') {
                                            // ÊúÄÈ´òlevelÔºåÊéíÂêçÂâç20%
                                            if (rankPercent <= 20) matched = true;
                                        } else if (range === '91-180Â§©') {
                                            if (rankPercent > 20 && rankPercent <= 40) matched = true;
                                        } else if (range === '31-90Â§©') {
                                            if (rankPercent > 40 && rankPercent <= 60) matched = true;
                                        } else if (range === '8-30Â§©') {
                                            if (rankPercent > 60 && rankPercent <= 80) matched = true;
                                        } else if (range === '1-7Â§©') {
                                            if (rankPercent > 80) matched = true;
                                        }
                                    }
                                    // Â§ÑÁêÜ "1-500Â≠ó", "501-2000Â≠ó" Á≠âÊ†ºÂºèÔºàsay.jsonÔºâ
                                    else if (range.includes('Â≠ó') && (range.includes('10001') || range.includes('5001') || range.includes('2001') || range.includes('501') || range.includes('1-500'))) {
                                        // say.jsonÁöÑÊ†ºÂºè
                                        const rankPercent = (rank / total) * 100;
                                        if (range === '10001+Â≠ó') {
                                            if (rankPercent <= 20) matched = true;
                                        } else if (range === '5001-10000Â≠ó') {
                                            if (rankPercent > 20 && rankPercent <= 40) matched = true;
                                        } else if (range === '2001-5000Â≠ó') {
                                            if (rankPercent > 40 && rankPercent <= 60) matched = true;
                                        } else if (range === '501-2000Â≠ó') {
                                            if (rankPercent > 60 && rankPercent <= 80) matched = true;
                                        } else if (range === '1-500Â≠ó') {
                                            if (rankPercent > 80) matched = true;
                                        }
                                    }
                                    // Â§ÑÁêÜ "1-50Â≠ó", "51-200Â≠ó" Á≠âÊ†ºÂºèÔºàword.jsonÔºâ
                                    // Ê≥®ÊÑèÔºöword.jsonÁöÑÊúÄÂêé‰∏Ä‰∏™rangeÊòØ"1001+"Ôºå‰∏çÂåÖÂê´"Â≠ó"
                                    else if (range === '1001+' || (range.includes('Â≠ó') && (range.includes('1001') || range.includes('501') || range.includes('201') || range.includes('51') || range.includes('1-50')))) {
                                        // word.jsonÁöÑÊ†ºÂºè
                                        const rankPercent = (rank / total) * 100;
                                        if (range === '1001+') {
                                            if (rankPercent <= 20) matched = true;
                                        } else if (range === '501-1000Â≠ó') {
                                            if (rankPercent > 20 && rankPercent <= 40) matched = true;
                                        } else if (range === '201-500Â≠ó') {
                                            if (rankPercent > 40 && rankPercent <= 60) matched = true;
                                        } else if (range === '51-200Â≠ó') {
                                            if (rankPercent > 60 && rankPercent <= 80) matched = true;
                                        } else if (range === '1-50Â≠ó') {
                                            if (rankPercent > 80) matched = true;
                                        }
                                    }
                                    
                                    if (matched && level.comments && level.comments.length > 0) {
                                        // ÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™comment
                                        const randomComment = level.comments[Math.floor(Math.random() * level.comments.length)];
                                        
                                        // Ê†πÊçÆËØ≠Ë®ÄÈÄâÊã©ÂØπÂ∫îÁöÑÊñáÊú¨
                                        let title = randomComment.title;
                                        let content = randomComment.content;
                                        let label = level.label;
                                        
                                        // Â¶ÇÊûúÂΩìÂâçËØ≠Ë®ÄÊòØËã±ÊñáÔºå‰ΩÜÊï∞ÊçÆÊòØ‰∏≠ÊñáÔºåÂ∞ùËØï‰ΩøÁî®Â§öËØ≠Ë®ÄÂ≠óÊÆµÊàñÊèê‰æõÈªòËÆ§ÁøªËØë
                                        if (lang === 'en') {
                                            // ‰ºòÂÖà‰ΩøÁî®Ëã±ÊñáÂ≠óÊÆµÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
                                            if (randomComment.title_en) {
                                                title = randomComment.title_en;
                                            }
                                            if (randomComment.content_en) {
                                                content = randomComment.content_en;
                                            }
                                            if (level.label_en) {
                                                label = level.label_en;
                                            }
                                        }
                                        
                                        return {
                                            title: title,
                                            content: content,
                                            label: label
                                        };
                                    }
                                }
                                
                                return null;
                            };
                            
                            // Áªü‰∏ÄÊõ¥Êñ∞ÊéíÂêçÂæΩÁ´†ÁöÑÂáΩÊï∞ÔºàÊö¥Èú≤Âà∞ÂÖ®Â±ÄÔºå‰ª•‰æøÂú®ËØ≠Ë®ÄÂàáÊç¢Êó∂Ë∞ÉÁî®Ôºâ
                            const updateRankingBadges = async (rankings, lang = 'zh-CN') => {
                                if (!rankings) return;
                                
                                // Ëé∑Âèñi18nÁøªËØëÂáΩÊï∞
                                const t = (key) => {
                                    if (window.i18n && window.i18n.getText) {
                                        return window.i18n.getText(key, lang);
                                    }
                                    return key;
                                };
                                
                                // Êõ¥Êñ∞ÊéíÂêçÂæΩÁ´†ÔºàÁªüËÆ°Âç°ÁâáÂè≥‰∏ãËßíÔºâ
                                const updateBadge = (badgeId, rank, total) => {
                                    const badge = document.getElementById(badgeId);
                                    if (!badge) return;
                                    
                                    if (rank !== null && rank !== undefined && total > 0) {
                                        const percent = ((total - rank + 1) / total * 100).toFixed(1);
                                        if (lang === 'en') {
                                            badge.textContent = `#${rank} (Top ${percent}%)`;
                                        } else {
                                            badge.textContent = `#${rank} (Ââç${percent}%)`;
                                        }
                                        badge.classList.add('has-rank');
                                    } else {
                                        badge.textContent = '--';
                                        badge.classList.remove('has-rank');
                                    }
                                };
                                
                                // Êõ¥Êñ∞"ÂÖ®ÁΩëÊ®™ÂêëÊéíÂêç"Âå∫ÂüüÁöÑÂç°ÁâáÔºàÂ§ßÂç°ÁâáÔºâ
                                const updateRankingCard = async (valueId, percentId, rank, total, jsonFile) => {
                                    const valueEl = document.getElementById(valueId);
                                    const percentEl = document.getElementById(percentId);
                                    
                                    // Á°Æ‰øùÊ†áÈ¢ò‰∏çÊç¢Ë°å
                                    if (valueEl) {
                                        valueEl.style.whiteSpace = 'nowrap';
                                        valueEl.style.overflow = 'hidden';
                                        valueEl.style.textOverflow = 'ellipsis';
                                    }
                                    if (percentEl) {
                                        percentEl.style.whiteSpace = 'nowrap';
                                        percentEl.style.overflow = 'hidden';
                                        percentEl.style.textOverflow = 'ellipsis';
                                    }
                                    
                                    if (rank !== null && rank !== undefined && total > 0) {
                                        // Âà§Êñ≠ÊòØÂê¶Âú®100ÂêçÂÜÖ
                                        if (rank <= 100) {
                                            // 100ÂêçÂÜÖÔºöÊòæÁ§∫ÊéíÂêçÊï∞Â≠óÂíåJSON‰∏≠ÁöÑÊ†áÈ¢òÂíåËØÑËØ≠
                                            const data = await loadRankingData(jsonFile, lang);
                                            const comment = getRankingComment(data, rank, total, lang);
                                            
                                            if (comment && valueEl && percentEl) {
                                                // valueElÊòæÁ§∫ÊéíÂêçÊï∞Â≠óÔºàÂ§ßÂ≠ó‰ΩìÔºåÂèÇËÄÉÊäÄÊúØÊéíÂêçÊ†∑ÂºèÔºâ
                                                valueEl.textContent = rank;
                                                valueEl.style.fontSize = '36px';
                                                valueEl.style.fontWeight = '700';
                                                valueEl.style.fontFamily = "'JetBrains Mono', monospace";
                                                
                                                // percentElÊòæÁ§∫JSON‰∏≠ÁöÑtitleÂíåcontent
                                                // strongÊ†áÁ≠æ‰ºöËá™Âä®Â∫îÁî®ÁªøËâ≤Âä†Á≤óÊ†∑ÂºèÔºàÈÄöËøáCSSÔºâ
                                                percentEl.innerHTML = `<strong>${comment.title}</strong><br/>${comment.content}`;
                                                percentEl.style.whiteSpace = 'normal'; // ÂÖÅËÆ∏Êç¢Ë°åÊòæÁ§∫content
                                                percentEl.style.color = '#ffffff'; // Á°Æ‰øùÂÜÖÂÆπÊñáÂ≠óÊòØÁôΩËâ≤
                                            } else {
                                                // Â¶ÇÊûúÊó†Ê≥ï‰ªéJSONËé∑ÂèñÔºå‰ΩøÁî®ÈªòËÆ§ÊòæÁ§∫
                                                const percent = ((total - rank + 1) / total * 100).toFixed(1);
                                                if (valueEl) {
                                                    valueEl.textContent = rank;
                                                    valueEl.style.fontSize = '36px';
                                                    valueEl.style.fontWeight = '700';
                                                    valueEl.style.fontFamily = "'JetBrains Mono', monospace";
                                                }
                                                if (percentEl) {
                                                    if (lang === 'en') {
                                                        percentEl.textContent = `Top ${percent}%`;
                                                    } else {
                                                        percentEl.textContent = `Ââç ${percent}%`;
                                                    }
                                                    percentEl.style.whiteSpace = 'nowrap';
                                                }
                                            }
                                        } else {
                                            // 101Âêç‰ª•ÂêéÔºöÂè™ÊòæÁ§∫Êï∞Â≠óÊéíÂêç
                                            if (valueEl) {
                                                valueEl.textContent = rank;
                                                valueEl.style.fontSize = '36px';
                                                valueEl.style.fontWeight = '700';
                                                valueEl.style.fontFamily = "'JetBrains Mono', monospace";
                                            }
                                            if (percentEl) {
                                                if (lang === 'en') {
                                                    percentEl.textContent = 'Rank';
                                                } else {
                                                    percentEl.textContent = 'Âêç';
                                                }
                                                percentEl.style.whiteSpace = 'nowrap';
                                            }
                                        }
                                    } else {
                                        if (valueEl) valueEl.textContent = '--';
                                        if (percentEl) percentEl.textContent = '--';
                                    }
                                };
                                
                                // Êõ¥Êñ∞ÂêÑ‰∏™ÁªüËÆ°Âç°ÁâáÁöÑÊéíÂêçÂæΩÁ´†ÔºàÂè≥‰∏ãËßíÂ∞èÂæΩÁ´†Ôºâ
                                updateBadge('rankingQingCountBadge', rankings.qingCount?.rank, rankings.qingCount?.total);
                                updateBadge('rankingBuCountBadge', rankings.buCount?.rank, rankings.buCount?.total);
                                updateBadge('rankingUserMessagesBadge', rankings.userMessages?.rank, rankings.userMessages?.total);
                                updateBadge('rankingTotalCharsBadge', rankings.totalUserChars?.rank, rankings.totalUserChars?.total);
                                updateBadge('rankingAvgLengthBadge', rankings.avgUserMessageLength?.rank, rankings.avgUserMessageLength?.total);
                                updateBadge('rankingUsageDaysBadge', rankings.usageDays?.rank, rankings.usageDays?.total);
                                
                                // Êõ¥Êñ∞"ÂÖ®ÁΩëÊ®™ÂêëÊéíÂêç"Âå∫ÂüüÁöÑÂç°ÁâáÔºàÂ§ßÂç°ÁâáÊòæÁ§∫Ôºâ
                                // ÂØπÂ∫îÂÖ≥Á≥ªÔºöno.json -> Áî≤ÊñπÁà∏Áà∏‰∏äË∫´, ai.json -> Ë∞ÉÊàèAI, please.json -> ËµõÂçöÁ£ïÂ§¥
                                // say.json -> Â∫üËØùËæìÂá∫ÔºàÊÄªÂ≠óÊï∞Ôºâ, word.json -> Âπ≥ÂùáÈïøÂ∫¶ÔºàÂçïÊ¨°Êåá‰ª§ÂéöÂ∫¶Ôºâ, day.json -> ‰∏äÂ≤óÂ§©Êï∞
                                await updateRankingCard('rankingQingCount', 'rankingQingCountPercent', rankings.qingCount?.rank, rankings.qingCount?.total, 'please.json');
                                await updateRankingCard('rankingBuCount', 'rankingBuCountPercent', rankings.buCount?.rank, rankings.buCount?.total, 'no.json');
                                await updateRankingCard('rankingUserMessages', 'rankingUserMessagesPercent', rankings.userMessages?.rank, rankings.userMessages?.total, 'ai.json');
                                await updateRankingCard('rankingTotalChars', 'rankingTotalCharsPercent', rankings.totalUserChars?.rank, rankings.totalUserChars?.total, 'say.json');
                                await updateRankingCard('rankingAvgLength', 'rankingAvgLengthPercent', rankings.avgUserMessageLength?.rank, rankings.avgUserMessageLength?.total, 'word.json');
                                await updateRankingCard('rankingUsageDays', 'rankingUsageDaysPercent', rankings.usageDays?.rank, rankings.usageDays?.total, 'day.json');
                            };
                            
                            // Â∞ÜupdateRankingBadgesÊö¥Èú≤Âà∞ÂÖ®Â±Ä‰ΩúÁî®Âüü
                            window.updateRankingBadges = updateRankingBadges;
                            
                            // ÂÆûÊó∂Êõ¥Êñ∞ÁªüËÆ°Êï∞ÊçÆÔºà‰ªé Cloudflare API Ëé∑ÂèñÔºâ
                            const updateRealtimeStats = async () => {
                                // Ê†ºÂºèÂåñÊï∞Â≠óÂáΩÊï∞ÔºàÁ°Æ‰øùÂú®‰ΩúÁî®ÂüüÂÜÖÂèØÁî®ÔºåÊîØÊåÅÂ§öËØ≠Ë®ÄÂíåÂ§ßÊï∞ÂÄºÔºâ
                                const formatNumberLocal = (num) => {
                                    if (typeof num !== 'number' || isNaN(num)) return '0';
                                    const currentLang = localStorage.getItem('appLanguage') || 'zh-CN';
                                    const isEn = currentLang === 'en';
                                    
                                    // Ëã±Êñá‰ΩøÁî®Ê†áÂáÜÊ†ºÂºèÔºöK, M, B, T
                                    if (isEn) {
                                        if (num >= 1000000000000) {
                                            return (num / 1000000000000).toFixed(1) + 'T';
                                        }
                                        if (num >= 1000000000) {
                                            return (num / 1000000000).toFixed(1) + 'B';
                                        }
                                        if (num >= 1000000) {
                                            return (num / 1000000).toFixed(1) + 'M';
                                        }
                                        if (num >= 1000) {
                                            return (num / 1000).toFixed(1) + 'K';
                                        }
                                        return num.toString();
                                    }
                                    
                                    // ‰∏≠Êñá‰ΩøÁî®‰∏á„ÄÅ‰∫øÁ≠âÂçï‰Ωç
                                    if (num >= 1000000000000) {
                                        return (num / 1000000000000).toFixed(1) + '‰∏á‰∫ø';
                                    }
                                    if (num >= 100000000000) {
                                        return (num / 100000000000).toFixed(1) + 'ÂçÉ‰∫ø';
                                    }
                                    if (num >= 10000000000) {
                                        return (num / 10000000000).toFixed(1) + 'Áôæ‰∫ø';
                                    }
                                    if (num >= 100000000) {
                                        return (num / 100000000).toFixed(1) + '‰∫ø';
                                    }
                                    if (num >= 10000000) {
                                        return (num / 10000000).toFixed(1) + 'ÂçÉ‰∏á';
                                    }
                                    if (num >= 1000000) {
                                        return (num / 1000000).toFixed(1) + 'Áôæ‰∏á';
                                    }
                                    if (num >= 100000) {
                                        return (num / 100000).toFixed(1) + 'ÂçÅ‰∏á';
                                    }
                                    if (num >= 10000) {
                                        return (num / 10000).toFixed(1) + '‰∏á';
                                    }
                                    if (num >= 1000) {
                                        return (num / 1000).toFixed(1) + 'K';
                                    }
                                    return num.toString();
                                };
                                
                                try {
                                    const apiUrl = 'https://cursor-clinical-analysis.psterman.workers.dev/';
                                    console.log('[ÂÆûÊó∂Êõ¥Êñ∞] ÂºÄÂßãËé∑Âèñ Cloudflare ÂÆûÊó∂Êï∞ÊçÆ...');
                                    
                                    const response = await fetch(apiUrl, {
                                        method: 'GET',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        mode: 'cors',
                                        cache: 'no-cache',
                                    });
                                    
                                    if (response.ok) {
                                        const data = await response.json();
                                        const value = data.value || data.totalUsers || data.total || data.count || 0;
                                        
                                        console.log('[ÂÆûÊó∂Êõ¥Êñ∞] API ËøîÂõûÊï∞ÊçÆ:', data, 'Ëß£ÊûêÂêéÁöÑÂÄº:', value);
                                        
                                        if (value >= 0) {
                                            // Êõ¥Êñ∞ React Áä∂ÊÄÅ
                                            setTotalUsers(value);
                                            setTotalTestUsers(value);
                                            const calculatedRank = Math.floor(value * 0.6);
                                            setTechRank(calculatedRank);
                                            const calculatedUnlocked = Math.min(100, parseFloat((value / 1000).toFixed(1)));
                                            setUnlockedCount(calculatedUnlocked);
                                            
                                            // Â¶ÇÊûú API ËøîÂõû‰∫ÜÊéíÂêçÊï∞ÊçÆÔºå‰πüÊõ¥Êñ∞ÊéíÂêçÂæΩÁ´†
                                            if (data.rankings) {
                                                window.userRankings = data.rankings;
                                                // Âª∂ËøüÊõ¥Êñ∞ÔºåÁ°Æ‰øù DOM ÂÖÉÁ¥†Â≠òÂú®
                                                setTimeout(async () => {
                                                    const currentLang = localStorage.getItem('appLanguage') || 'zh-CN';
                                                    await updateRankingBadges(data.rankings, currentLang);
                                                    console.log('[ÂÆûÊó∂Êõ¥Êñ∞] ÊéíÂêçÂæΩÁ´†Â∑≤Êõ¥Êñ∞:', data.rankings);
                                                }, 100);
                                            }
                                            
                                            // Êõ¥Êñ∞ DOM ÂÖÉÁ¥†
                                            const totalUsersEl = document.getElementById('totalTestUsers');
                                            const techRankEl = document.getElementById('techRank');
                                            const personalityUnlockEl = document.getElementById('personalityUnlock');
                                            
                                            if (totalUsersEl) {
                                                // ‰ΩøÁî® formatNumber Â§ÑÁêÜÊòæÁ§∫Ê†ºÂºè
                                                const formatted = formatNumberLocal(value);
                                                totalUsersEl.textContent = formatted;
                                                // Ê∑ªÂä†Êõ¥Êñ∞Âä®Áîª
                                                totalUsersEl.classList.add('animate-pulse');
                                                setTimeout(() => {
                                                    totalUsersEl.classList.remove('animate-pulse');
                                                }, 600);
                                                console.log('[ÂÆûÊó∂Êõ¥Êñ∞] ÂÖ®ÁΩëÂèóËôê‰∫∫Êï∞Â∑≤Êõ¥Êñ∞:', formatted);
                                            } else {
                                                console.warn('[ÂÆûÊó∂Êõ¥Êñ∞] Êú™ÊâæÂà∞ totalTestUsers ÂÖÉÁ¥†');
                                            }
                                            
                                            if (techRankEl) {
                                                // ‰ΩøÁî® formatNumber Â§ÑÁêÜÊòæÁ§∫Ê†ºÂºè
                                                const formatted = formatNumberLocal(calculatedRank);
                                                techRankEl.textContent = formatted;
                                                techRankEl.classList.add('animate-pulse');
                                                setTimeout(() => {
                                                    techRankEl.classList.remove('animate-pulse');
                                                }, 600);
                                                console.log('[ÂÆûÊó∂Êõ¥Êñ∞] ÊäÄÊúØÊéíÂêçÂ∑≤Êõ¥Êñ∞:', formatted);
                                            } else {
                                                console.warn('[ÂÆûÊó∂Êõ¥Êñ∞] Êú™ÊâæÂà∞ techRank ÂÖÉÁ¥†');
                                            }
                                            
                                            if (personalityUnlockEl) {
                                                personalityUnlockEl.textContent = calculatedUnlocked.toFixed(1) + '%';
                                                personalityUnlockEl.classList.add('animate-pulse');
                                                setTimeout(() => {
                                                    personalityUnlockEl.classList.remove('animate-pulse');
                                                }, 600);
                                                console.log('[ÂÆûÊó∂Êõ¥Êñ∞] ‰∫∫Ê†ºÂ∫ìËß£ÈîÅÂ∑≤Êõ¥Êñ∞:', calculatedUnlocked.toFixed(1) + '%');
                                            } else {
                                                console.warn('[ÂÆûÊó∂Êõ¥Êñ∞] Êú™ÊâæÂà∞ personalityUnlock ÂÖÉÁ¥†');
                                            }
                                            
                                            console.log('[ÂÆûÊó∂Êõ¥Êñ∞] ÁªüËÆ°Êï∞ÊçÆÂ∑≤ÂÖ®ÈÉ®Êõ¥Êñ∞:', {
                                                totalUsers: value,
                                                techRank: calculatedRank,
                                                unlockedCount: calculatedUnlocked
                                            });
                                        } else {
                                            console.warn('[ÂÆûÊó∂Êõ¥Êñ∞] API ËøîÂõûÁöÑÂÄºÊó†Êïà');
                                        }
                                    } else {
                                        console.warn('[ÂÆûÊó∂Êõ¥Êñ∞] API ËØ∑Ê±ÇÂ§±Ë¥•ÔºåÁä∂ÊÄÅÁ†Å:', response.status);
                                    }
                                } catch (error) {
                                    console.error('[ÂÆûÊó∂Êõ¥Êñ∞] Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•:', error.message, error);
                                }
                            };
                            
                            // Á≠âÂæÖ DOM ÂÆåÂÖ®Ê∏≤ÊüìÂêéÂÜçÊõ¥Êñ∞ÔºàÂª∂ËøüÊâßË°å‰ª•Á°Æ‰øùÂÖÉÁ¥†Â≠òÂú®Ôºâ
                            setTimeout(() => {
                                console.log('[ÂÆûÊó∂Êõ¥Êñ∞] ÂºÄÂßãÈ¶ñÊ¨°Êõ¥Êñ∞ÂÆûÊó∂ÁªüËÆ°Êï∞ÊçÆ...');
                                updateRealtimeStats();
                                
                                // Ê∏ÖÁêÜ‰πãÂâçÁöÑÂÆöÊó∂Âô®ÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
                                if (window.realtimeStatsInterval) {
                                    clearInterval(window.realtimeStatsInterval);
                                }
                                
                                // ÊØè30ÁßíËá™Âä®Âà∑Êñ∞‰∏ÄÊ¨°
                                window.realtimeStatsInterval = setInterval(() => {
                                    console.log('[ÂÆûÊó∂Êõ¥Êñ∞] ÂÆöÊó∂Âà∑Êñ∞ÁªüËÆ°Êï∞ÊçÆ...');
                                    updateRealtimeStats();
                                }, 30000);
                            }, 500);
                        }, 200);
                    } else {
                        console.error('ÂÆπÂô®ÊàñÊ®°ÂùóÊú™ÊâæÂà∞');
                    }
                }, 100);
            };

            // ÁîüÊàêÂàÜ‰∫´ÈìæÊé•
            const generateShareUrl = () => {
                try {
                    // Ëé∑ÂèñÊéíÂêçÊï∞ÊçÆÔºà‰ªé window.userRankingsÔºâ
                    const rankings = window.userRankings || {};
                    
                    // ÊèêÂèñ4È°πÊéíÂêçÊï∞ÊçÆ
                    const shareData = {
                        wordRank: rankings.avgUserMessageLength?.rank || null,      // Âπ≥ÂùáÈïøÂ∫¶ÊéíÂêç
                        pleaseRank: rankings.qingCount?.rank || null,                // ËµõÂçöÁ£ïÂ§¥ÊéíÂêç
                        noRank: rankings.buCount?.rank || null,                     // Áî≤ÊñπÁà∏Áà∏‰∏äË∫´ÊéíÂêç
                        dayRank: rankings.usageDays?.rank || null,                  // ‰∏äÂ≤óÂ§©Êï∞ÊéíÂêç
                        // È¢ùÂ§ñ‰øùÂ≠òÊÄªÊï∞ÔºåÁî®‰∫éËÆ°ÁÆóÁôæÂàÜÊØî
                        totals: {
                            word: rankings.avgUserMessageLength?.total || 0,
                            please: rankings.qingCount?.total || 0,
                            no: rankings.buCount?.total || 0,
                            day: rankings.usageDays?.total || 0
                        },
                        // ‰øùÂ≠òÂàÜÊûêÊï∞ÊçÆÔºàÁî®‰∫éÂÆåÊï¥Â±ïÁ§∫Ôºâ
                        analysisData: {
                            stats: window.analysisModule?.getGlobalStats() || null,
                            vibeResult: window.analysisModule?.getVibeResult() || null
                        },
                        rankings: rankings // ‰øùÂ≠òÂÆåÊï¥ÊéíÂêçÊï∞ÊçÆ
                    };
                    
                    // ËΩ¨Êç¢‰∏∫ Base64
                    const jsonString = JSON.stringify(shareData);
                    const base64String = btoa(encodeURIComponent(jsonString));
                    
                    // ÁîüÊàêÂÆåÊï¥ÈìæÊé•
                    const shareUrl = window.location.origin + window.location.pathname + '#share=' + base64String;
                    
                    return shareUrl;
                } catch (error) {
                    console.error('[ÂàÜ‰∫´] ÁîüÊàêÂàÜ‰∫´ÈìæÊé•Â§±Ë¥•:', error);
                    return null;
                }
            };

            // ÂàÜ‰∫´Êä•Âëä
            const shareReport = async () => {
                const shareUrl = generateShareUrl();
                if (!shareUrl) {
                    alert('ÁîüÊàêÂàÜ‰∫´ÈìæÊé•Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
                    return;
                }
                
                try {
                    // Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø
                    await navigator.clipboard.writeText(shareUrl);
                    alert('ÂàÜ‰∫´ÈìæÊé•Â∑≤ÁîüÊàêÔºåPCÁ´ØÁÇπÂºÄÂèØ‰∫§‰∫íÔºåÊâãÊú∫ÁÇπÂºÄÁõ¥Êé•ÁúãÁªìÊûú');
                } catch (err) {
                    // ÈôçÁ∫ßÊñπÊ°àÔºö‰ΩøÁî®‰º†ÁªüÊñπÊ≥ï
                    const textArea = document.createElement('textarea');
                    textArea.value = shareUrl;
                    textArea.style.position = 'fixed';
                    textArea.style.opacity = '0';
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        alert('ÂàÜ‰∫´ÈìæÊé•Â∑≤ÁîüÊàêÔºåPCÁ´ØÁÇπÂºÄÂèØ‰∫§‰∫íÔºåÊâãÊú∫ÁÇπÂºÄÁõ¥Êé•ÁúãÁªìÊûú');
                    } catch (e) {
                        // Â¶ÇÊûúÂ§çÂà∂Â§±Ë¥•ÔºåÊòæÁ§∫ÈìæÊé•ËÆ©Áî®Êà∑ÊâãÂä®Â§çÂà∂
                        prompt('ËØ∑ÊâãÂä®Â§çÂà∂‰ª•‰∏ãÈìæÊé•:', shareUrl);
                    }
                    document.body.removeChild(textArea);
                }
            };

            // ÂØºÂá∫Êä•Âëä
            const exportReport = async () => {
                try {
                    const exportArea = document.getElementById('exportArea');
                    if (!exportArea) {
                        alert('ÂØºÂá∫Âå∫ÂüüÊú™ÊâæÂà∞');
                        return;
                    }
                    
                    const canvas = await html2canvas(exportArea, {
                        backgroundColor: '#ffffff',
                        scale: 2,
                        useCORS: true,
                        logging: false,
                    });

                    const link = document.createElement('a');
                    link.download = `cursor-audit-${new Date().getTime()}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                } catch (err) {
                    console.error('ÂØºÂá∫Â§±Ë¥•:', err);
                    alert('ÂØºÂá∫Â§±Ë¥•: ' + err.message);
                }
            };

            // ËøîÂõûÂàùÂßãÂàÜÊûêÁïåÈù¢
            const resetToUpload = () => {
                // Ê∏ÖÁ©∫ Hash
                window.location.hash = '';
                // ÈáçÁΩÆÁä∂ÊÄÅ
                setIsShareMode(false);
                setShareRankings(null);
                setStep('upload');
                // Âà∑Êñ∞È°µÈù¢
                window.location.reload();
            };

            return (
                <div className="min-h-screen text-zinc-100 p-4 md:p-8 flex flex-col items-center justify-center relative">
                    <div className="fixed top-0 left-0 w-full h-1 bg-green-500 shadow-[0_0_8px_rgba(0,255,65,0.8)] z-50" />

                    {/* ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ• */}
                    <input 
                        type="file" 
                        ref={folderInputRef}
                        webkitdirectory=""
                        directory=""
                        multiple 
                        style={{ display: 'none' }}
                        onChange={(e) => {
                            console.log('Êñá‰ª∂Â§πÈÄâÊã©‰∫ã‰ª∂Ëß¶Âèë', e.target.files);
                            handleFileUpload(e, 'folder');
                        }}
                    />
                    <input 
                        type="file" 
                        ref={fileInputRef}
                        accept=".vscdb,.db,.sqlite,.sqlite3" 
                        multiple 
                        style={{ display: 'none' }}
                        onChange={(e) => {
                            console.log('Êñá‰ª∂ÈÄâÊã©‰∫ã‰ª∂Ëß¶Âèë', e.target.files);
                            handleFileUpload(e, 'file');
                        }}
                    />

                    {/* ËØ≠Ë®ÄÂàáÊç¢ÊåâÈíÆ */}
                    <div style={{
                        position: 'fixed',
                        top: '20px',
                        right: '20px',
                        zIndex: 1000,
                        display: 'flex',
                        gap: '8px'
                    }}>
                        <button
                            onClick={() => switchLanguage('zh-CN')}
                            style={{
                                padding: '0',
                                background: 'transparent',
                                border: lang === 'zh-CN' 
                                    ? '3px solid var(--accent-terminal)' 
                                    : 'none',
                                borderRadius: '50%',
                                cursor: 'pointer',
                                fontFamily: "'JetBrains Mono', monospace",
                                transition: 'opacity 0.3s ease, transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                width: '44px',
                                height: '44px',
                                opacity: lang === 'zh-CN' ? 1 : 0.6,
                                boxShadow: lang === 'zh-CN' 
                                    ? '0 0 16px rgba(0, 255, 65, 0.6), 0 0 32px rgba(0, 255, 65, 0.3), inset 0 0 20px rgba(0, 255, 65, 0.1)' 
                                    : 'none',
                                transform: lang === 'zh-CN' ? 'scale(1.1)' : 'scale(1)',
                                overflow: 'hidden'
                            }}
                            onMouseEnter={(e) => {
                                if (lang !== 'zh-CN') {
                                    e.currentTarget.style.opacity = '0.9';
                                    e.currentTarget.style.transform = 'scale(1.15)';
                                    e.currentTarget.style.transition = 'opacity 0.25s ease, transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1)';
                                } else {
                                    // ÈÄâ‰∏≠Áä∂ÊÄÅÔºö‰øùÊåÅ 3px Á≤óËæπÊ°ÜÔºåÂè™ÊîπÂèòÁº©ÊîæÂíåÈò¥ÂΩ±
                                    e.currentTarget.style.border = '3px solid var(--accent-terminal)';
                                    e.currentTarget.style.transform = 'scale(1.15)';
                                    e.currentTarget.style.boxShadow = '0 0 20px rgba(0, 255, 65, 0.8), 0 0 40px rgba(0, 255, 65, 0.4), inset 0 0 25px rgba(0, 255, 65, 0.15)';
                                    e.currentTarget.style.transition = 'opacity 0.25s ease, transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.25s ease';
                                }
                            }}
                            onMouseLeave={(e) => {
                                if (lang === 'zh-CN') {
                                    // ÈÄâ‰∏≠Áä∂ÊÄÅÔºö‰øùÊåÅ 3px Á≤óËæπÊ°ÜÔºåÂè™ÊîπÂèòÁº©ÊîæÂíåÈò¥ÂΩ±
                                    e.currentTarget.style.border = '3px solid var(--accent-terminal)';
                                    e.currentTarget.style.opacity = '1';
                                    e.currentTarget.style.transform = 'scale(1.1)';
                                    e.currentTarget.style.boxShadow = '0 0 16px rgba(0, 255, 65, 0.6), 0 0 32px rgba(0, 255, 65, 0.3), inset 0 0 20px rgba(0, 255, 65, 0.1)';
                                    e.currentTarget.style.transition = 'opacity 0.3s ease, transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease';
                                } else {
                                    e.currentTarget.style.opacity = '0.6';
                                    e.currentTarget.style.transform = 'scale(1)';
                                    e.currentTarget.style.boxShadow = 'none';
                                    e.currentTarget.style.transition = 'opacity 0.3s ease, transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease';
                                }
                            }}
                            title="‰∏≠Êñá"
                        >
                            <img 
                                src="images/zh.png" 
                                alt="‰∏≠Êñá" 
                                style={{
                                    width: '100%',
                                    height: '100%',
                                    objectFit: 'contain',
                                    borderRadius: '50%',
                                    transition: 'all 0.4s ease',
                                    padding: '2px',
                                    outline: 'none',
                                    border: 'none',
                                    boxShadow: 'none',
                                    WebkitAppearance: 'none',
                                    appearance: 'none'
                                }}
                            />
                        </button>
                        <button
                            onClick={() => switchLanguage('en')}
                            style={{
                                padding: '0',
                                background: 'transparent',
                                border: lang === 'en' 
                                    ? '3px solid var(--accent-terminal)' 
                                    : 'none',
                                borderRadius: '50%',
                                cursor: 'pointer',
                                fontFamily: "'JetBrains Mono', monospace",
                                transition: 'opacity 0.3s ease, transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                width: '44px',
                                height: '44px',
                                opacity: lang === 'en' ? 1 : 0.6,
                                boxShadow: lang === 'en' 
                                    ? '0 0 16px rgba(0, 255, 65, 0.6), 0 0 32px rgba(0, 255, 65, 0.3), inset 0 0 20px rgba(0, 255, 65, 0.1)' 
                                    : 'none',
                                transform: lang === 'en' ? 'scale(1.1)' : 'scale(1)',
                                overflow: 'hidden'
                            }}
                            onMouseEnter={(e) => {
                                if (lang !== 'en') {
                                    e.currentTarget.style.opacity = '0.9';
                                    e.currentTarget.style.transform = 'scale(1.15)';
                                    e.currentTarget.style.transition = 'opacity 0.25s ease, transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1)';
                                } else {
                                    // ÈÄâ‰∏≠Áä∂ÊÄÅÔºö‰øùÊåÅ 3px Á≤óËæπÊ°ÜÔºåÂè™ÊîπÂèòÁº©ÊîæÂíåÈò¥ÂΩ±
                                    e.currentTarget.style.border = '3px solid var(--accent-terminal)';
                                    e.currentTarget.style.transform = 'scale(1.15)';
                                    e.currentTarget.style.boxShadow = '0 0 20px rgba(0, 255, 65, 0.8), 0 0 40px rgba(0, 255, 65, 0.4), inset 0 0 25px rgba(0, 255, 65, 0.15)';
                                    e.currentTarget.style.transition = 'opacity 0.25s ease, transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.25s ease';
                                }
                            }}
                            onMouseLeave={(e) => {
                                if (lang === 'en') {
                                    // ÈÄâ‰∏≠Áä∂ÊÄÅÔºö‰øùÊåÅ 3px Á≤óËæπÊ°ÜÔºåÂè™ÊîπÂèòÁº©ÊîæÂíåÈò¥ÂΩ±
                                    e.currentTarget.style.border = '3px solid var(--accent-terminal)';
                                    e.currentTarget.style.opacity = '1';
                                    e.currentTarget.style.transform = 'scale(1.1)';
                                    e.currentTarget.style.boxShadow = '0 0 16px rgba(0, 255, 65, 0.6), 0 0 32px rgba(0, 255, 65, 0.3), inset 0 0 20px rgba(0, 255, 65, 0.1)';
                                    e.currentTarget.style.transition = 'opacity 0.3s ease, transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease';
                                } else {
                                    e.currentTarget.style.opacity = '0.6';
                                    e.currentTarget.style.transform = 'scale(1)';
                                    e.currentTarget.style.boxShadow = 'none';
                                    e.currentTarget.style.transition = 'opacity 0.3s ease, transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease';
                                }
                            }}
                            title="English"
                        >
                            <img 
                                src="images/us.png" 
                                alt="English" 
                                style={{
                                    width: '100%',
                                    height: '100%',
                                    objectFit: 'contain',
                                    borderRadius: '50%',
                                    transition: 'all 0.4s ease',
                                    padding: '2px',
                                    outline: 'none',
                                    border: 'none',
                                    boxShadow: 'none',
                                    WebkitAppearance: 'none',
                                    appearance: 'none'
                                }}
                            />
                        </button>
                    </div>

                    {/* ‰∏ä‰º†Èò∂ÊÆµ */}
                    {step === 'upload' && (
                        <div className="max-w-2xl w-full space-y-8 text-center">
                            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-zinc-900 border border-zinc-800 text-xs text-white mb-4 mx-auto">
                                <Icon name="zap" size={12} />
                                <a href="https://github.com/psterman/cursor-lab" target="_blank" rel="noopener noreferrer" style={{ color: 'inherit', textDecoration: 'none' }} onMouseEnter={(e) => e.target.style.color = 'var(--accent-terminal)'} onMouseLeave={(e) => e.target.style.color = 'inherit'}>
                                    <span>{t('dashboard.clinicalAnalysis')}</span>
                                </a>
                            </div>
                            <h1 style={{
                                fontSize: 'clamp(2rem, 5vw, 3.5rem)',
                                fontWeight: 800,
                                letterSpacing: '-0.05em',
                                background: 'linear-gradient(to bottom, #fff 30%, #a1a1a1 100%)',
                                WebkitBackgroundClip: 'text',
                                backgroundClip: 'text',
                                WebkitTextFillColor: 'transparent',
                                marginBottom: '15px',
                                transition: 'all 0.3s ease'
                            }}>
                                <a 
                                    href="https://github.com/psterman/cursor-lab" 
                                    target="_blank" 
                                    rel="noopener noreferrer" 
                                    style={{ 
                                        color: 'inherit', 
                                        textDecoration: 'none',
                                        display: 'inline-block',
                                        transition: 'all 0.3s ease',
                                        position: 'relative',
                                        filter: 'blur(2px)'
                                    }} 
                                    onMouseEnter={(e) => { 
                                        e.target.style.filter = 'blur(0px)';
                                        e.target.style.textShadow = '0 0 20px var(--accent-terminal), 0 0 40px var(--accent-terminal)';
                                    }} 
                                    onMouseLeave={(e) => { 
                                        e.target.style.filter = 'blur(2px)';
                                        e.target.style.textShadow = 'none';
                                    }}
                                >
                                    {t('title')}
                                </a>
                            </h1>
                            <p className="text-zinc-500 text-lg max-w-md mx-auto">
                                {t('subtitle')}
                            </p>
                            
                            {error && (
                                <div className="bg-red-900/20 border border-red-800 text-red-400 p-4 rounded-sm font-mono">
                                    {error}
                                </div>
                            )}
                            
                            <div className="group relative p-12 mt-12 border-2 border-dashed border-zinc-800 rounded-sm hover:border-green-500/50 transition-all cursor-pointer bg-zinc-900/50">
                                <div className="relative z-10 space-y-4 text-center">
                                    <a href="https://github.com/psterman/cursor-lab" target="_blank" rel="noopener noreferrer" style={{ display: 'block', textDecoration: 'none' }} onMouseEnter={(e) => { e.target.style.opacity = '0.8'; }} onMouseLeave={(e) => { e.target.style.opacity = '1'; }}>
                                        <img src="images/CUBE_2D_DARK.png" width="64" height="64" style={{ marginBottom: '20px', display: 'block', margin: '0 auto 20px auto' }} className="upload-icon" alt="Upload" />
                                    </a>
                                    <a href="https://github.com/psterman/cursor-lab" target="_blank" rel="noopener noreferrer" style={{ textDecoration: 'none', color: 'inherit' }} onMouseEnter={(e) => { e.target.style.color = 'var(--accent-terminal)'; }} onMouseLeave={(e) => { e.target.style.color = 'var(--text-main)'; }}>
                                        <h2 style={{ marginBottom: '10px', fontSize: '20px', fontWeight: 600, color: 'var(--text-main)' }}>{t('upload.title')}</h2>
                                    </a>
                                    <a href="https://github.com/psterman/cursor-lab" target="_blank" rel="noopener noreferrer" style={{ textDecoration: 'none', color: 'inherit' }} onMouseEnter={(e) => { e.target.style.color = 'var(--accent-terminal)'; }} onMouseLeave={(e) => { e.target.style.color = 'var(--text-dim)'; }}>
                                        <p style={{ color: 'var(--text-dim)', marginBottom: '25px' }}>{t('upload.subtitle')}</p>
                                    </a>
                                    <div className="flex gap-4 justify-center mt-6">
                                        <button 
                                            onClick={() => handleFileSelect('folder')}
                                            className="px-6 py-3 bg-green-500 hover:bg-transparent hover:text-green-500 text-black rounded-sm font-semibold transition-colors border border-green-500 uppercase tracking-wider font-mono"
                                        >
                                        {t('upload.selectFolder')}
                                        </button>
                                        {/* <button 
                                            onClick={() => handleFileSelect('file')}
                                            className="px-6 py-3 bg-transparent hover:bg-zinc-700 text-white rounded-sm font-semibold transition-colors border border-zinc-700 uppercase tracking-wider font-mono"
                                        >
                                            ÈÄâÊã©state.vscdb
                                        </button> */}
                                    </div>
                                    {/* ÊïëËµéË∑ØÂæÑÂ§çÂà∂Âô® */}
                                    <div style={{ 
                                        marginTop: '24px', 
                                        padding: '12px 16px', 
                                        background: 'rgba(24, 24, 27, 0.8)', 
                                        border: '1px solid var(--card-border)', 
                                        borderRadius: '2px',
                                        fontFamily: "'JetBrains Mono', monospace"
                                    }}>
                                        <div style={{ 
                                            display: 'flex', 
                                            alignItems: 'center', 
                                            justifyContent: 'space-between', 
                                            gap: '12px',
                                            marginBottom: '8px'
                                        }}>
                                            <code style={{ 
                                                color: 'var(--accent-terminal)', 
                                                fontSize: '12px', 
                                                flex: 1, 
                                                textAlign: 'left',
                                                wordBreak: 'break-all',
                                                fontFamily: "'JetBrains Mono', monospace"
                                            }} id="workspacePath">
                                                {(navigator.platform.toLowerCase().includes('win') || navigator.userAgent.toLowerCase().includes('windows')) 
                                                    ? '%APPDATA%\\Cursor\\User\\workspaceStorage\\' 
                                                    : '~/Library/Application Support/Cursor/User/workspaceStorage/'}
                                            </code>
                                            <button 
                                                onClick={(e) => {
                                                    const pathEl = document.getElementById('workspacePath');
                                                    const path = pathEl ? pathEl.textContent : '';
                                                    navigator.clipboard.writeText(path).then(() => {
                                                        const btn = e.target;
                                                        const originalText = btn.textContent;
                                                        btn.textContent = t('dashboard.copied');
                                                        btn.style.color = 'var(--accent-terminal)';
                                                        btn.style.background = 'var(--accent-terminal)';
                                                        btn.style.color = '#050505';
                                                        setTimeout(() => {
                                                            btn.textContent = originalText;
                                                            btn.style.background = 'transparent';
                                                            btn.style.color = 'var(--accent-terminal)';
                                                        }, 2000);
                                                    }).catch(err => {
                                                        console.error('Â§çÂà∂Â§±Ë¥•:', err);
                                                        alert(t('dashboard.copyFailed'));
                                                    });
                                                }}
                                                style={{
                                                    padding: '6px 12px',
                                                    background: 'transparent',
                                                    border: '1px solid var(--accent-terminal)',
                                                    borderRadius: '2px',
                                                    color: 'var(--accent-terminal)',
                                                    fontSize: '11px',
                                                    cursor: 'pointer',
                                                    fontFamily: "'JetBrains Mono', monospace",
                                                    textTransform: 'uppercase',
                                                    letterSpacing: '0.05em',
                                                    transition: 'all 0.2s ease',
                                                    whiteSpace: 'nowrap'
                                                }}
                                                onMouseEnter={(e) => {
                                                    e.target.style.background = 'var(--accent-terminal)';
                                                    e.target.style.color = '#050505';
                                                }}
                                                onMouseLeave={(e) => {
                                                    e.target.style.background = 'transparent';
                                                    e.target.style.color = 'var(--accent-terminal)';
                                                }}
                                            >
                                                {t('dashboard.copy')}
                                            </button>
                                        </div>
                                        <p style={{ 
                                            color: '#ffffff', 
                                            fontSize: '10px', 
                                            margin: 0,
                                            textAlign: 'left',
                                            fontFamily: "'JetBrains Mono', monospace",
                                            opacity: 0.8
                                        }}>
                                            {'> '}{t('upload.pathHelp')}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ÂàÜÊûêÈò∂ÊÆµ */}
                    {step === 'analyzing' && (
                        <div className="w-full max-w-lg bg-zinc-950 border border-zinc-800 rounded-sm p-6 shadow-2xl overflow-hidden">
                            <div className="flex items-center gap-2 mb-4 border-b border-zinc-900 pb-3">
                                <Icon name="terminal" size={16} className="text-green-500" />
                                <span className="text-xs text-zinc-500 uppercase tracking-widest">{t('dashboard.systemAnalysis')}</span>
                            </div>
                            <div className="space-y-2 h-64 overflow-y-auto custom-scrollbar">
                                {logs.map((log, i) => (
                                    <div key={i} className="text-sm text-zinc-400 font-mono">
                                        {log}
                                    </div>
                                ))}
                                <div className="w-2 h-5 bg-green-500 animate-pulse inline-block" />
                            </div>
                        </div>
                    )}

                    {/* È¢ÑËßàÁªìÊûúÈò∂ÊÆµ */}
                    {step === 'preview' && analysisData && (
                        <div className="max-w-4xl w-full space-y-6">
                            <div className="bg-zinc-900 border border-zinc-800 rounded-sm p-6 md:p-8 relative overflow-hidden shadow-2xl">
                                
                                <div className="flex flex-col md:flex-row justify-between items-start gap-6">
                                    <div className={`space-y-4 flex-1 ${lang === 'en' ? 'md:max-w-lg' : 'md:max-w-md'}`}>
                                        <div>
                                            <h2 className="text-zinc-500 text-sm uppercase tracking-widest mb-1 font-mono">{t('preview.personalityLabel')}</h2>
                                            <div className="text-5xl font-black text-white font-mono">
                                                {analysisData.vibeResult?.personalityName || t('dashboard.unknownPersonality')}
                                            </div>
                                        </div>
                                        <p className={`text-zinc-400 ${lang === 'en' ? 'text-base' : 'text-lg'}`}>
                                            {analysisData.vibeResult?.roastText || t('preview.analyzing')}
                                        </p>
                                    </div>

                                    <div className={`grid grid-cols-2 gap-4 ${lang === 'en' ? 'md:w-[460px]' : 'md:w-[420px]'} w-full md:w-auto`}>
                                        <StatBox 
                                            label={t('dashboard.totalUsers')} 
                                            value={formatNumber(totalUsers)} 
                                            sub={t('dashboard.personUnit')} 
                                            color="text-white"
                                            lang={lang}
                                        />
                                        <StatBox 
                                            label={t('dashboard.cyberBowCount')} 
                                            value={analysisData.stats?.qingCount || 0} 
                                            sub={t('dashboard.timesUnit')} 
                                            color="text-white"
                                            lang={lang}
                                        />
                                        <StatBox 
                                            label={t('preview.globalRank')} 
                                            value={calculateRank(analysisData.stats?.qingCount || 0)} 
                                            sub={lang === 'en' ? t('dashboard.rankUnit') : '%'} 
                                            color="text-white"
                                            lang={lang}
                                        />
                                        <StatBox 
                                            label={t('statsLabels.totalConversations')} 
                                            value={calculateUsageDays(analysisData.stats)} 
                                            sub={t('statsLabels.unit.days')} 
                                            color="text-white"
                                            lang={lang}
                                        />
                                    </div>
                                </div>
                            </div>

                            <div className="flex flex-col sm:flex-row gap-4 justify-center pt-4">
                                <button 
                                    onClick={showFullReport}
                                    className="flex items-center justify-center gap-2 bg-green-500 text-black px-8 py-4 rounded-sm font-bold hover:bg-transparent hover:text-green-500 transition-colors border border-green-500 uppercase tracking-wider font-mono"
                                >
                                    <Icon name="share-2" size={20} />
                                    {t('preview.shareBtn')}
                                </button>
                                <button 
                                    onClick={shareReport}
                                    className="flex items-center justify-center gap-2 bg-blue-500 text-white px-8 py-4 rounded-sm font-bold hover:bg-transparent hover:text-blue-500 transition-colors border border-blue-500 uppercase tracking-wider font-mono"
                                >
                                    <Icon name="link" size={20} />
                                    ÂàÜ‰∫´Êä•Âëä
                                </button>
                                <button 
                                    onClick={exportReport}
                                    className="flex items-center justify-center gap-2 bg-transparent text-white px-8 py-4 rounded-sm font-bold border border-zinc-800 hover:bg-zinc-800 transition-colors uppercase tracking-wider font-mono"
                                >
                                    <Icon name="download" size={20} />
                                    {t('export.title')}
                                </button>
                            </div>
                        </div>
                    )}

                    {/* ÂÆåÊï¥Êä•ÂëäÈò∂ÊÆµ */}
                    {step === 'fullReport' && (
                        <div className="w-full" style={{minHeight: '100vh'}}>
                            {/* ÂàÜ‰∫´Ê®°ÂºèÊèêÁ§∫ */}
                            {isShareMode && (
                                <div className="w-full bg-blue-500/20 border border-blue-500/50 rounded-sm p-4 mb-4 flex flex-col sm:flex-row items-center justify-between gap-4" style={{marginBottom: '20px', maxWidth: '1100px', margin: '0 auto 20px', padding: '16px'}}>
                                    <div className="flex items-center gap-3">
                                        <Icon name="info" size={20} className="text-blue-400" />
                                        <span className="text-white font-mono text-sm sm:text-base">
                                            Ê≠£Âú®Êü•ÁúãÂàÜ‰∫´ÁöÑÊä•Âëä
                                        </span>
                                    </div>
                                    <button 
                                        onClick={resetToUpload}
                                        className="flex items-center justify-center gap-2 bg-green-500 text-black px-6 py-2 rounded-sm font-bold hover:bg-transparent hover:text-green-500 transition-colors border border-green-500 uppercase tracking-wider font-mono text-sm"
                                    >
                                        <Icon name="refresh-cw" size={16} />
                                        Êàë‰πüË¶ÅÊµã
                                    </button>
                                </div>
                            )}
                            
                            {/* ÊµÆÂä®ÂàÜ‰∫´ÊåâÈíÆÔºàÈùûÂàÜ‰∫´Ê®°ÂºèÊó∂ÊòæÁ§∫Ôºâ */}
                            {!isShareMode && (
                                <div className="fixed bottom-24 right-4 z-50" style={{zIndex: 1000}}>
                                    <button 
                                        onClick={shareReport}
                                        className="flex items-center justify-center gap-2 bg-blue-500 text-white px-4 py-3 rounded-sm font-bold hover:bg-transparent hover:text-blue-500 transition-colors border border-blue-500 uppercase tracking-wider font-mono text-sm shadow-lg"
                                        title="ÂàÜ‰∫´Êä•Âëä"
                                    >
                                        <Icon name="link" size={18} />
                                        <span className="hidden sm:inline">ÂàÜ‰∫´</span>
                                    </button>
                                </div>
                            )}
                            
                            <div id="fullReportContainer" style={{display: 'block'}}></div>
                        </div>
                    )}

                    {/* ÂèãÊÉÖÈìæÊé• */}
                    <div style={{
                        position: 'fixed',
                        bottom: '20px',
                        left: '50%',
                        transform: 'translateX(-50%)',
                        display: 'flex',
                        gap: '24px',
                        alignItems: 'center',
                        zIndex: 100,
                        fontFamily: "'JetBrains Mono', monospace"
                    }}>
                        <a 
                            href="https://github.com/psterman/nmer" 
                            target="_blank" 
                            rel="noopener noreferrer"
                            style={{
                                display: 'flex',
                                alignItems: 'center',
                                gap: '8px',
                                padding: '8px 12px',
                                background: 'rgba(24, 24, 27, 0.8)',
                                border: '1px solid var(--card-border)',
                                borderRadius: '2px',
                                color: 'var(--text-main)',
                                textDecoration: 'none',
                                transition: 'all 0.2s ease',
                                fontSize: '12px'
                            }}
                            onMouseEnter={(e) => {
                                e.target.style.borderColor = 'var(--accent-terminal)';
                                e.target.style.color = 'var(--accent-terminal)';
                            }}
                            onMouseLeave={(e) => {
                                e.target.style.borderColor = 'var(--card-border)';
                                e.target.style.color = 'var(--text-main)';
                            }}
                        >
                            <img 
                                src="https://github.com/psterman/nmer/blob/main/favicon.ico?raw=true" 
                                alt={lang === 'zh-CN' ? 'ÁâõÈ©¨' : 'NMER'} 
                                width="32" 
                                height="32"
                            />
                            <span>{t('dashboard.friendLinks.nmer')}</span>
                        </a>
                        <a 
                            href="https://github.com/psterman/curser" 
                            target="_blank" 
                            rel="noopener noreferrer"
                            style={{
                                display: 'flex',
                                alignItems: 'center',
                                gap: '8px',
                                padding: '8px 12px',
                                background: 'rgba(24, 24, 27, 0.8)',
                                border: '1px solid var(--card-border)',
                                borderRadius: '2px',
                                color: 'var(--text-main)',
                                textDecoration: 'none',
                                transition: 'all 0.2s ease',
                                fontSize: '12px'
                            }}
                            onMouseEnter={(e) => {
                                e.target.style.borderColor = 'var(--accent-terminal)';
                                e.target.style.color = 'var(--accent-terminal)';
                            }}
                            onMouseLeave={(e) => {
                                e.target.style.borderColor = 'var(--card-border)';
                                e.target.style.color = 'var(--text-main)';
                            }}
                        >
                            <img 
                                src="https://github.com/psterman/nmer/blob/main/curser.ico?raw=true" 
                                alt={lang === 'zh-CN' ? 'Êä†Êêú' : 'CURSER'} 
                                width="32" 
                                height="32"
                            />
                            <span>{t('dashboard.friendLinks.curser')}</span>
                        </a>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    
</body>
</html>
