<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSP：地理由后端 CF 接管，无需 ipapi.co/ip-api.com -->
     <script data-cfasync="false" src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://html2canvas.hertzen.com https://cdn.tailwindcss.com; connect-src 'self' https://cdn.jsdelivr.net https://unpkg.com https://cursor-clinical-analysis.psterman.workers.dev https://*.workers.dev https://psterman.supabase.co https://dtcplfhcgnxdzpigmotb.supabase.co wss://dtcplfhcgnxdzpigmotb.supabase.co https://raw.githubusercontent.com https://api.github.com https://www.google.com wss://*.supabase.co; img-src 'self' data: blob: https:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.tailwindcss.com; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com https://r2cdn.perplexity.ai;">
    <title>Global Statistics Dashboard - Vibe Coding</title>
    <!-- 
    ============================================
    API 端点配置（V2EX/技术用户优化版）
    ============================================
    
    【目标用户】V2EX 用户、专业程序员
    【用户画像】70% 有科学上网能力，30% 公司/学校网络受限
    
    【优化策略】
    1. 检测代理可用性，自动选择最佳路径
    2. 有代理用户 → 直接访问 Cloudflare（最佳体验）
    3. 无代理用户 → 快速失败，使用本地缓存
    4. 提供明确的网络诊断信息
    -->
    
    <!-- 主端点：Cloudflare Workers（有代理用户最优） -->
    <meta name="api-endpoint" content="https://cursor-clinical-analysis.psterman.workers.dev/">
    
    <!-- 备用端点（可选：Vercel/国内函数） -->
    <meta name="api-endpoint-backup" content="">
    
    <!-- 技术用户优化：快速检测代理，1秒超时 -->
    <meta name="api-fast-fail" content="true">
    <meta name="proxy-detect-timeout" content="1500">
    
    
    
    
    
    <!-- 
    ===========================================
    离线优先资源加载策略（本地 > 国内CDN > 国际CDN）
    ===========================================
    -->
    
    
    <!-- Tailwind 离线回退样式 -->
    
    
    <!-- 延迟加载非关键资源 -->
    <script src="https://unpkg.com/lucide@latest" async></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" async></script>
    
  <link rel="stylesheet" crossorigin href="assets/css/stats2.css">
</head>
<body class="p-4 md:p-8">
    <!-- 顶部固定 Header -->
    <div class="top-header">
        <div class="top-header-left">
            <div class="top-header-title">
                <h1>
                    <span class="lang-key text-white" data-key="top-title" data-t="top-title">Cursor行为报告全球分布图</span>
                </h1>
                <p id="sub-title">Telemetry Uplink: Active // Source: Central_Pacific</p>
            </div>
        </div>
        
        <div class="top-header-right">
            <!-- 活跃节点卡片 -->
            <div class="top-header-card">
                <div class="top-header-card-label lang-key" data-key="active-nodes" data-t="active-nodes">活跃节点</div>
                <div class="top-header-card-value text-[var(--accent-terminal)]">
                    <span class="w-1.5 h-1.5 bg-[var(--accent-terminal)] rounded-full pulse"></span>
                    <span id="online-count-value">0</span> CONNECTED
                </div>
            </div>
            
            <!-- 体检人数卡片：显示已上传过聊天记录的人数 -->
            <div class="top-header-card">
                <div class="top-header-card-label lang-key" data-key="threat-level" data-t="threat-level">体检人数</div>
                <div id="physical-exam-count" class="top-header-card-value text-[var(--accent-terminal)]">--</div>
            </div>
            
            <!-- 国家选择下拉菜单 -->
            <div class="top-header-card" style="position: relative;">
                <div class="top-header-card-label lang-key" data-key="select-country" data-t="select-country">选择国家</div>
                <select id="country-select-dropdown" class="country-select-dropdown">
                    <option value="">-- 选择国家 --</option>
                </select>
            </div>
            
            <!-- 语言切换按钮 -->
            <div class="flex gap-2 items-center">
                <button type="button" id="btn-zh" class="lang-flag-btn active" title="中文" aria-label="中文" data-lang="zh">
                    <img src="./assets/zh-BUU2yN9i.png" alt="中文" />
                </button>
                <button type="button" id="btn-en" class="lang-flag-btn" title="English" aria-label="English" data-lang="en">
                    <img src="./assets/us-DYKU2e25.png" alt="English" />
                </button>
            </div>
        </div>
    </div>
    
    <!-- 全屏地图背景 -->
    <div id="map-container"></div>
    <div id="map-updated-at" class="fixed bottom-3 right-3 text-[10px] text-zinc-500 font-mono z-[5] pointer-events-none" style="display:none;"></div>
    <!-- 地图光标工具：用于手动校准（避免光标消失时无法进入校准） -->
    <div id="map-cursor-tools" aria-live="polite">
        <button type="button" id="btn-anchor-location" class="tool-btn">
            <span style="display:inline-block;width:8px;height:8px;border-radius:999px;background:#3b82f6;"></span>
            <span id="btn-anchor-location-text">定位锚点</span>
        </button>
        <button type="button" id="btn-country-selector" class="tool-btn">
            <span style="display:inline-block;width:8px;height:8px;border-radius:999px;background:#8b5cf6;"></span>
            <span>身份设置</span>
        </button>
        <button type="button" id="btn-calibrate-location" class="tool-btn">
            <span style="display:inline-block;width:8px;height:8px;border-radius:999px;background:#00ff41;"></span>
            <span id="btn-calibrate-location-text">校准位置</span>
        </button>
        <button type="button" id="btn-reset-location" class="tool-btn" style="display: none;">
            <span style="display:inline-block;width:8px;height:8px;border-radius:999px;background:#ef4444;"></span>
            <span>退出锚定</span>
        </button>
        <div id="map-cursor-hint" class="hint">
            <div><b>校准模式</b>：拖动地图上的 <b>YOU</b> 光标，或点击地图任意位置设置坐标。</div>
            <div style="margin-top:6px;">完成后会自动保存到本机与后端（`manual_lat/manual_lng/manual_location`）。</div>
            <div style="margin-top:6px; opacity:0.9;">提示：你也可以先点击国家来设置“锚定国家”，再校准坐标。</div>
        </div>
        <div id="map-anchor-hint" class="hint">
            <div><b>锚定模式</b>：点击地图任意位置，光标立即移动到该坐标，并停止所有基于 IP 的自动重写。</div>
            <div style="margin-top:6px;">坐标将持久化保存，并绑定到你的 GitHub 账号。</div>
        </div>
    </div>
    
    <!-- 国家选择器浮窗 -->
    <div id="country-selector-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 200; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px); pointer-events: auto;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 500px; max-height: 80vh; background: rgba(5, 5, 5, 0.95); border: 1px solid rgba(0, 255, 65, 0.45); border-radius: 4px; padding: 20px; overflow: hidden; display: flex; flex-direction: column;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="color: #00ff41; font-family: 'JetBrains Mono', monospace; font-size: 14px; margin: 0;">身份设置</h3>
                <button id="country-selector-close" style="background: none; border: none; color: #00ff41; font-size: 20px; cursor: pointer; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;" title="关闭">✕</button>
            </div>
            <input type="text" id="country-search-input" placeholder="搜索国家..." style="width: 100%; padding: 8px 12px; background: rgba(0, 0, 0, 0.5); border: 1px solid rgba(0, 255, 65, 0.3); color: #00ff41; font-family: 'JetBrains Mono', monospace; font-size: 12px; margin-bottom: 12px; outline: none;">
            <div id="country-list-container" style="flex: 1; overflow-y: auto; max-height: calc(80vh - 120px);">
                <!-- 国家列表将通过 JavaScript 动态填充 -->
            </div>
        </div>
    </div>
    
    
    <!-- 用户详情浮层（预留在 HTML 中，由事件委托打开；内容可由 JS 填充） -->
    <div id="user-modal" class="hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 20000; background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; pointer-events: auto;">
        <div class="user-modal-content" style="background: rgba(5, 5, 5, 0.95); border: 1px solid rgba(0, 255, 65, 0.45); border-radius: 8px; padding: 24px; max-width: 90%; max-height: 85vh; overflow: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="color: #00ff41; font-family: 'JetBrains Mono', monospace; font-size: 14px; margin: 0;">用户详情</h3>
                <button type="button" id="user-modal-close" style="background: none; border: none; color: #00ff41; font-size: 20px; cursor: pointer;">✕</button>
            </div>
            <div id="user-modal-body"><!-- 由 JS 填充 --></div>
        </div>
    </div>
    
    
    <!-- 左右赛博朋克抽屉 -->
    <div id="left-drawer" class="cyber-drawer left-drawer">
        <div class="drawer-content">
            <div class="drawer-header">
                <div class="drawer-title">
                    <span class="drawer-icon">⚡</span>
                    <span class="drawer-title-text" id="left-drawer-title">国家数据</span>
                </div>
                <div class="drawer-close-btn" onclick="closeDrawers()">✕</div>
            </div>
            <!-- 国家选择菜单区域 -->
            <div id="left-drawer-country-selector" style="
                padding: 16px 20px;
                border-bottom: 1px solid rgba(0, 255, 65, 0.2);
                background: rgba(0, 255, 65, 0.03);
                position: relative;
                z-index: 2;
            ">
                <div style="
                    font-size: 11px;
                    color: rgba(0, 255, 65, 0.8);
                    font-family: 'JetBrains Mono', monospace;
                    font-weight: 700;
                    margin-bottom: 8px;
                    text-transform: uppercase;
                    letter-spacing: 1px;
                " class="lang-key" data-key="select-country" data-t="select-country">选择国家</div>
                <input 
                    type="text" 
                    id="left-drawer-country-search" 
                    placeholder="" 
                    style="
                        width: 100%;
                        padding: 8px 12px;
                        background: rgba(0, 0, 0, 0.6);
                        border: 1px solid rgba(0, 255, 65, 0.4);
                        color: #00ff41;
                        font-family: 'JetBrains Mono', monospace;
                        font-size: 12px;
                        outline: none;
                        margin-bottom: 8px;
                        border-radius: 2px;
                        box-shadow: 0 0 8px rgba(0, 255, 65, 0.2);
                        transition: all 0.2s;
                    "
                    data-placeholder-zh="搜索国家..."
                    data-placeholder-en="Search countries..."
                />
                <div 
                    id="left-drawer-country-list" 
                    class=""
                    style="
                        background: rgba(0, 0, 0, 0.3);
                    "
                >
                    <!-- 国家列表将通过 JavaScript 动态填充，默认收起，点击搜索框后展开 -->
                </div>
            </div>
            <div class="drawer-body left-drawer-body" id="left-drawer-body">
                <!-- 上方可滚动：矩阵绿天梯榜 -->
                <div class="left-drawer-scroll" id="left-drawer-scroll">
                    <div id="global-ranking-area" class="space-y-6 block"></div>
                </div>
                <!-- 最下方：本国词云卡片（左抽屉风格、自适应高度） -->
                <div class="left-drawer-wordcloud-card" id="left-drawer-wordcloud-wrap">
                    <div class="left-drawer-wordcloud-header">
                        <span class="left-drawer-wordcloud-title" data-t="panel.wordcloud">本国词云</span>
                        <span class="left-drawer-wordcloud-hint" id="vibe-country-hint">国家：--</span>
                    </div>
                    <div class="left-drawer-wordcloud-inner">
                        <div class="left-drawer-wordcloud-meta-row">
                            <span class="left-drawer-wordcloud-label" data-i18n="panel.national_cloud_50">本国词云 50</span>
                            <span class="left-drawer-wordcloud-meta font-mono" id="vibe-cloud50-meta">--</span>
                        </div>
                        <div id="national-identity-tabs" class="left-drawer-wordcloud-tabs">
                            <button type="button" class="national-identity-tab left-drawer-wordcloud-tab" data-level="Novice" data-t="lexicon.novice">小白</button>
                            <button type="button" class="national-identity-tab left-drawer-wordcloud-tab" data-level="Professional" data-t="lexicon.pro">脱发</button>
                            <button type="button" class="national-identity-tab left-drawer-wordcloud-tab" data-level="Architect" data-t="lexicon.arch">霸天</button>
                        </div>
                        <div class="left-drawer-wordcloud-canvas-wrap" id="vibe-cloud50-container">
                            <canvas id="canvas-novice" data-level="Novice" aria-hidden="false"></canvas>
                            <canvas id="canvas-pro" data-level="Professional" style="display: none;" aria-hidden="true"></canvas>
                            <canvas id="canvas-arch" data-level="Architect" style="display: none;" aria-hidden="true"></canvas>
                            <canvas id="national-identity-cloud-canvas" style="display: none;" aria-hidden="true"></canvas>
                            <div id="cloud-loading-hint" class="left-drawer-cloud-loading hidden">加载中...</div>
                        </div>
                        <div id="vibe-cloud50-empty" class="left-drawer-wordcloud-empty hidden" data-t="hotlist.building">正在扫描该国开发者指纹...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="right-drawer" class="cyber-drawer right-drawer">
        <div class="drawer-content">
            <div class="drawer-header">
                <div class="drawer-title">
                    <span class="drawer-icon">🔍</span>
                    <span class="drawer-title-text" id="right-drawer-title" data-i18n="drawer.details">详细信息</span>
                </div>
                <div class="drawer-header-actions">
                    <button type="button" class="drawer-refresh-btn" id="right-drawer-refresh-btn" onclick="typeof refreshRightDrawerContent === 'function' && refreshRightDrawerContent()" title="刷新" aria-label="刷新">
                        <svg class="drawer-refresh-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                    </button>
                    <div class="drawer-close-btn" onclick="closeDrawers()">✕</div>
                </div>
            </div>
            
            <!-- 【新增】Tab 导航栏 -->
            <div class="drawer-tabs" id="right-drawer-tabs">
                <button type="button" class="drawer-tab active" data-tab="ranking" onclick="switchView('ranking')">
                    <span class="tab-icon">🏆</span>
                    <span class="tab-text" data-t="tab.ranking" data-i18n="tab.ranking">排行榜</span>
                </button>
                <button type="button" class="drawer-tab" data-tab="global" onclick="switchView('global')">
                    <span class="tab-icon">🌍</span>
                    <span class="tab-text" data-t="tab.global" data-i18n="tab.global">全球</span>
                </button>
                <button type="button" class="drawer-tab" data-tab="country" onclick="switchView('country')">
                    <span class="tab-icon">🏰</span>
                    <span class="tab-text" data-t="tab.country" data-i18n="tab.country">国家</span>
                </button>
            </div>
            
            <div class="drawer-body" id="right-drawer-body">
                <!-- 【重构】全球视图 -->
                <div id="panel-global-view" class="right-drawer-panel flex flex-col h-full overflow-y-auto">
                    <div id="panel-global-content" class="flex-1 flex flex-col gap-4 min-h-0 p-4">
                        <!-- 全球视图内容将通过 JavaScript 动态填充 -->
                        <div class="text-zinc-500 text-xs text-center py-8">加载中...</div>
                    </div>
                </div>
                
                <!-- 【重构】国家视图：点击地图即切换并刷新，无需单独刷新按钮 -->
                <div id="panel-country-view" class="right-drawer-panel hidden flex-col h-full overflow-y-auto">
                    <div id="countryTemplateMount" class="flex-1 min-h-0 px-4 py-4 pb-4" style="font-family: 'JetBrains Mono', monospace;"></div>
                </div>
                
                <!-- 【新增】排行榜视图 - 六个全球排行榜卡片 + 高分图谱 -->
                <div id="panel-ranking-view" class="right-drawer-panel hidden flex-col h-full overflow-y-auto">
                    <div id="panel-ranking-content" class="flex-1 flex flex-col gap-4 min-h-0 p-4">
                        <div class="flex justify-end mb-1">
                            <button type="button" onclick="var f=window.renderGlobalLadders||window.renderGreenLadders; if(f) f(f===window.renderGlobalLadders?undefined:true); else location.reload();" class="ranking-refresh-btn" data-t="ranking.refresh">刷新</button>
                        </div>
                        <div id="view-ranking">
                            <div id="ladders-container">
                                <!-- 六个全球排行榜卡片 - renderGlobalLadders 会写入此处或其子节点 global-ranking-grids -->
                                <div id="global-ranking-grids" class="industrial-ranking-grid flex flex-col gap-3"></div>
                            </div>
                            <!-- 高分图谱容器 - drawHighScores 函数会在此渲染6个排行榜 -->
                            <div class="vibe-index-leaderboard space-y-4">
                                <!-- 卡片将由 JavaScript 动态渲染 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="scanLine" class="scan-line" aria-hidden="true"></div>
    <!-- right.html 模板：用于国家透视右侧抽屉（美国） -->
    <template id="rightDrawerTemplate">
        <div class="country-panel-template">
            <div class="report-container">
                <!-- HEADER -->
                <div class="mb-8 border-b-2 border-white pb-4">
                    <div class="flex justify-between items-start">
                        <h1 class="text-2xl font-black italic tracking-tighter" id="rtPanelTitle" data-t="panel.country_panel" data-i18n="panel.country_panel">国家透视</h1>
                        <div class="status-tag" id="rtStatusTag" data-i18n="panel.live_feed">实时数据</div>
                    </div>
                    <div class="mt-3">
                        <span id="rtMeritBoard" class="inline-block text-[11px] text-[var(--accent-terminal)] border border-[var(--accent-terminal)]/40 bg-[var(--accent-terminal)]/5 px-2 py-1">
                            已累计分析 -- 万字
                        </span>
                        <span id="rtJiafangCount" class="ml-2 text-[10px] text-zinc-400" title="加方词数">--</span>
                        <span id="rtKetaoCount" class="ml-2 text-[10px] text-zinc-400" title="客套词数">--</span>
                        <span id="rtWorkDays" class="ml-2 text-[10px] text-zinc-400" title="工作天数">--</span>
                    </div>
                    <div class="text-[11px] mt-3 text-zinc-500 flex justify-between uppercase">
                        <span id="rtCoord">坐标：--</span>
                        <span id="rtDataStatus">数据：稳定</span>
                    </div>
                </div>

                <!-- [01] MACRO SCALE -->
                <div class="clinic-card">
                    <div class="card-header">
                        <i data-lucide="globe"></i>
                        <span class="card-title" data-t="panel.stats" data-i18n="panel.stats">统计</span>
                    </div>
                    <div class="flex justify-between items-center mb-8">
                        <div class="text-5xl" id="rtFlag">🏳️</div>
                        <div class="text-right">
                            <div class="metric-value" id="rtNodeName">--</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-6">
                        <div id="rtUsersCard">
                            <div class="metric-label" data-t="panel.dev_scale" data-i18n="panel.dev_scale">开发者规模</div>
                            <div class="metric-value" id="rtDiagnosedTotal">--</div>
                        </div>
                        <div id="rtAnalysisCard">
                            <div class="metric-label" data-t="panel.scan_count" data-i18n="panel.scan_count">诊断次数</div>
                            <div class="metric-value" id="rtScanTotal">--</div>
                        </div>
                    </div>
                </div>

                <!-- [01.5] RADAR -->
                <div class="clinic-card">
                    <div class="card-header">
                        <i data-lucide="target"></i>
                        <span class="card-title" data-t="panel.radar" data-i18n="panel.radar">开发者画像</span>
                    </div>
                    <div id="rtRadar" style="height: 260px; width: 100%;"></div>
                </div>

                <!-- [01.6] LIVE FEED -->
                <div class="clinic-card">
                    <div class="card-header">
                        <i data-lucide="radio"></i>
                        <span class="card-title" data-t="panel.personality_distribution" data-i18n="panel.personality_distribution">人格分布</span>
                    </div>
                    <div id="rtRealtimeList" class="space-y-3 text-[11px] leading-snug"></div>
                </div>

                <!-- [01.7] COUNTRY TOTALS -->
                <div class="clinic-card">
                    <div class="card-header">
                        <i data-lucide="bar-chart-3"></i>
                        <span class="card-title" data-t="panel.country_totals" data-i18n="panel.country_totals">国家累计</span>
                    </div>
                    <div id="rtCountryTotals" class="space-y-2 text-[11px] leading-snug"></div>
                </div>

                <!-- [01.8] MY COUNTRY RANK -->
                <div class="clinic-card">
                    <div class="card-header">
                        <i data-lucide="trophy"></i>
                        <span class="card-title" data-t="panel.my_country_rank" data-i18n="panel.my_country_rank">我的排名</span>
                    </div>
                    <div id="rtMyCountryRanks" class="space-y-2 text-[11px] leading-snug"></div>
                </div>

                <!-- [02] POWER STRUGGLE (PK) -->
                <div class="clinic-card">
                    <div class="card-header">
                        <i data-lucide="swords"></i>
                        <span class="card-title" data-t="panel.qa_attitude">问答态度</span>
                    </div>
                    <div class="space-y-5">
                        <div class="flex justify-between text-[11px] font-bold uppercase">
                            <span class="text-white" id="rtPkLeftLabel">傲娇</span>
                            <span class="text-[var(--accent-terminal)]" id="rtPkRightLabel">跪舔</span>
                        </div>
                        <div class="pk-track">
                            <div class="pk-divider"></div>
                            <div class="pk-left" id="rtPkLeftFill" style="width: 50%;"></div>
                            <div class="pk-right" id="rtPkRightFill" style="width: 50%;"></div>
                        </div>
                        <div class="flex justify-between text-[16px] font-bold">
                            <span>
                                <span class="text-[10px] text-zinc-500 mr-2" data-t="pk.domineering">霸道值</span>
                                <span id="rtPkLeftPct">50.0%</span>
                            </span>
                            <span class="text-[var(--accent-terminal)]">
                                <span class="text-[10px] text-zinc-500 mr-2" data-t="pk.bootlick">跪舔值</span>
                                <span id="rtPkRightPct">50.0%</span>
                            </span>
                        </div>
                        <div>
                            <div class="flex justify-between items-center text-[11px]">
                                <span class="text-zinc-500 uppercase tracking-widest" data-i18n="panel.pk_power">权力值</span>
                                <span class="text-white font-bold" id="rtPowerScore">--</span>
                            </div>
                            <div class="mt-2 h-1 bg-zinc-800 w-full overflow-hidden">
                                <div id="power-bar" class="h-full bg-white" style="width: 0%;"></div>
                            </div>
                        </div>
                        <div class="p-3 bg-zinc-900 border-l-2 border-white text-xs leading-relaxed italic text-zinc-300" id="rtPkQuote" style="display:none"></div>
                    </div>
                </div>

                <!-- [03] EMOTIONAL AUDIT -->
                <div class="clinic-card">
                    <div class="card-header">
                        <i data-lucide="activity"></i>
                        <span class="card-title" data-t="panel.meltdown_audit">破防监测</span>
                    </div>
                    <div class="space-y-5">
                        <div>
                            <div class="flex justify-between items-end">
                                <div class="metric-label" data-t="panel.meltdown_index">破防指数</div>
                                <div class="text-sm font-bold" id="rtBreakdownRate">--</div>
                            </div>
                            <div class="stat-bar-container">
                                <div class="stat-bar-fill" id="breakdown-bar" style="width: 0%;"></div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mt-6">
                            <div class="bg-zinc-900 p-3 border border-zinc-800">
                                <div class="metric-label" data-t="panel.meltdown_level">破防等级</div>
                                <div class="text-white font-bold text-lg" id="rtMeltdownLevel">--</div>
                            </div>
                            <div class="bg-zinc-900 p-3 border border-zinc-800">
                                <div class="metric-label" data-t="panel.meltdown_victims">受虐人数</div>
                                <div class="text-[var(--accent-terminal)] font-bold text-lg" id="rtMeltdownVictims">--</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- [04] SEMANTIC BURST -->
                <div class="clinic-card" id="vibe-explosion-card">
                    <div class="card-header">
                        <i data-lucide="cloud"></i>
                        <span class="card-title" data-t="panel.wordcloud">本国词云</span>
                        <div class="ml-auto flex items-center gap-3"></div>
                    </div>
                    <div class="p-2" id="rtSemanticTags">
                        <!-- 黑话榜：按国家聚合（Top10 + Cloud50） -->
                        <div class="bg-zinc-950/60 border border-zinc-800 p-2 mb-4" id="vibe-burst-root">
                            <div class="flex items-center justify-between mb-2">
                                <div class="text-[11px] text-zinc-400 uppercase tracking-widest" data-t="hotlist.title">黑话榜</div>
                            </div>

                            <!-- 本国词云已移至左侧抽屉 -->

                            <!-- 下方：文字榜单（分类词库 Top 10，Tab 切换功德簿/黑话/口头禅） -->
                            <div class="border border-white/10 bg-zinc-950/30 p-2">
                                <div class="flex items-center justify-between mb-2">
                                    <div id="vibe-top10-title" class="text-[10px] text-zinc-500 uppercase tracking-widest" data-i18n="panel.country_top_10">本国 Prompt 高频词组 Top 10</div>
                                    <div class="text-[10px] text-zinc-600 font-mono" id="vibe-country-top10-meta">--</div>
                                </div>
                                <div id="vibe-lexicon-tabs" class="flex gap-1 mb-2">
                                    <button type="button" class="vibe-lexicon-tab px-2 py-1 text-[10px] rounded border border-white/20 bg-[var(--accent-terminal)]/20 text-[var(--accent-terminal)] font-medium" data-type="merit_board" data-t="lexicon.merit">功德簿</button>
                                    <button type="button" class="vibe-lexicon-tab px-2 py-1 text-[10px] rounded border border-white/10 bg-transparent text-zinc-400 hover:bg-white/5" data-type="slang_list" data-t="lexicon.slang">行业黑话</button>
                                    <button type="button" class="vibe-lexicon-tab px-2 py-1 text-[10px] rounded border border-white/10 bg-transparent text-zinc-400 hover:bg-white/5" data-type="mantra_top" data-t="lexicon.mantra">全民口头禅</button>
                                </div>
                                <ol id="vibe-top10-list" class="space-y-1"></ol>
                                <div id="vibe-top10-empty" class="hidden text-zinc-500 text-sm p-3 italic" data-t="hotlist.collecting">
                                    暂无数据（正在收录中...）
                                </div>
                            </div>

                        </div>
                        <div class="text-xs text-zinc-300 mb-3" id="rtCoreTrait" data-t="semantic.core_trait_empty">该地区核心特质：--</div>
                        <div class="flex justify-between items-center text-[11px]">
                            <span class="text-zinc-500 uppercase tracking-widest" data-i18n="panel.semantic_label">语义</span>
                            <span class="text-[var(--accent-terminal)] font-bold" id="rtSemanticScore">--</span>
                        </div>
                        <div class="mt-2 h-1 bg-zinc-800 w-full overflow-hidden">
                            <div id="semantic-bar" class="h-full bg-[#00ff41]" style="width: 0%;"></div>
                        </div>
                    </div>
                    <div class="mt-4 pt-3 border-t border-zinc-800 flex justify-between text-[11px]">
                        <span class="text-zinc-500" id="rtSemanticMostUsed">最常用：--</span>
                        <span class="text-[var(--accent-terminal)]" id="rtSemanticFreq">频次：--</span>
                    </div>
                </div>

                <!-- [05] ELITE RANKING -->
                <div class="clinic-card">
                    <div class="card-header">
                        <i data-lucide="users"></i>
                        <span class="card-title" data-t="panel.lpdef_ranking">高分图谱</span>
                    </div>
                    <div id="rtTopTalentsHeroes" class="flex flex-wrap gap-2 mb-3"></div>
                    <div class="scrolling-wrapper" id="rtEliteList">
                        <div id="rtTopTalentsList" class="vibe-index-leaderboard space-y-2"></div>
                    </div>
                    <div class="text-[10px] text-zinc-500 mt-2 text-center uppercase tracking-tighter" id="rtEliteHint" data-i18n="panel.elite_hint">
                        左滑查看高分图谱
                    </div>
                </div>

                <!-- [06] GLOBAL SHARE -->
                <div class="clinic-card">
                    <div class="card-header">
                        <i data-lucide="pie-chart"></i>
                        <span class="card-title" data-t="panel.global_ratio">全球占比</span>
                    </div>
                    <div class="chart-container">
                        <div id="rtGlobalRatioPie" style="width: 200px; height: 200px;"></div>
                    </div>
                    <div class="mt-3">
                        <div class="flex justify-between items-center text-[11px]">
                            <span class="text-zinc-500 uppercase tracking-widest" data-i18n="panel.ratio_label">占比</span>
                            <span class="text-[var(--accent-terminal)] font-bold" id="rtRatioPct">--</span>
                        </div>
                        <div class="mt-2 h-1 bg-zinc-800 w-full overflow-hidden">
                            <div id="ratio-bar" class="h-full bg-white" style="width: 0%;"></div>
                        </div>
                    </div>
                    <div class="mt-2 text-[11px] text-zinc-400">
                        <span class="text-zinc-500" data-i18n="panel.global_ratio_label">全球占比：</span>
                        <span id="rtGlobalRatio" class="text-[var(--accent-terminal)] font-bold">--</span>
                    </div>
                    <div class="space-y-2 mt-2" id="rtRatioList"></div>
                </div>
            </div>
        </div>
    </template>
    <div class="max-w-[1600px] mx-auto relative z-10">
        <!-- Main Dashboard Layout -->
        <div class="grid grid-cols-1 xl:grid-cols-12 gap-6">
            
            <!-- Side Panel: Core Metrics (左侧) - 已移至抽屉，隐藏 -->
            <div class="xl:col-span-3 flex flex-col gap-4 order-2 xl:order-1 items-start" style="display: none;">
                <!-- 统计卡片已移至右边抽屉，隐藏原容器 -->
                <div class="hacker-border p-6 rounded-sm stat-card" style="display: none;">
                    <div class="text-[10px] text-zinc-500 mb-2 uppercase tracking-widest lang-key" data-key="total-victims">已诊断开发者</div>
                    <div id="totalUsers" class="text-4xl font-bold text-[var(--accent-terminal)]">0</div>
                    <div class="mt-4 text-[9px] text-zinc-600 font-mono">USERS_RECOGNIZED_SUCCESSFULLY</div>
                </div>

                <div class="hacker-border p-6 rounded-sm stat-card" style="display: none;">
                    <div class="text-[10px] text-zinc-500 mb-2 uppercase tracking-widest lang-key" data-key="total-analysis">全网扫描次数</div>
                    <div id="totalAnalysis" class="text-4xl font-bold">0</div>
                    <div class="mt-4 text-[9px] text-zinc-600 font-mono">TOTAL_SCAN_COUNT</div>
                </div>

                <div class="hacker-border p-6 rounded-sm stat-card" style="display: none;">
                    <div class="text-[10px] text-zinc-500 mb-2 uppercase tracking-widest lang-key" data-key="total-roast">累计吐槽字数</div>
                    <div id="totalChars" class="text-4xl font-bold">0</div>
                    <div class="mt-4 h-1 bg-zinc-800 w-full overflow-hidden">
                        <div class="bg-[var(--accent-terminal)] h-full w-[65%]"></div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 stat-card" style="display: none;">
                    <div class="hacker-border p-4 rounded-sm bg-zinc-900/50">
                        <div class="text-zinc-500 text-[10px] uppercase tracking-tighter mb-1">Avg Words / 人均平均篇幅</div>
                        <div id="avgPerUser" class="text-2xl font-bold font-mono text-[var(--accent-terminal)]">0</div>
                        <div class="text-[9px] text-zinc-600 mt-1 uppercase">Per Developer Basis</div>
                    </div>
                    
                    <div class="hacker-border p-4 rounded-sm bg-zinc-900/50">
                        <div class="text-zinc-500 text-[10px] uppercase tracking-tighter mb-1">Scan Words / 单次平均篇幅</div>
                        <div id="avgPerScan" class="text-2xl font-bold font-mono text-[var(--accent-terminal)]">0</div>
                        <div class="text-[9px] text-zinc-600 mt-1 uppercase">Per Analysis Basis</div>
                    </div>
                </div>

                <div class="hacker-border p-6 rounded-sm stat-card bg-zinc-900/40" style="display: none;">
                    <div class="text-[10px] text-zinc-500 mb-4 uppercase tracking-widest lang-key" data-key="radar-title">全网平均开发者画像</div>
                    <div class="aspect-square">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Central Map Area (中间) - 地图已移至全屏背景，此区域已移除 -->
            <!-- 维度排名卡片容器：已移至抽屉显示 -->
            <div id="rank-cards-container" style="display: none;">
                <!-- 卡片已移至抽屉显示 -->
            </div>
        </div>

        <!-- Secondary Charts & Logs (右侧) - 已移至抽屉，隐藏原容器 -->
        <div class="xl:col-span-3 grid grid-cols-1 gap-6 mt-6 items-start" style="display: none;">
            <div class="hacker-border p-6 rounded-sm">
                <h3 class="text-xs font-bold text-zinc-400 mb-6 uppercase tracking-widest lang-key" data-key="hot-list">地理位置热力排行</h3>
                <div id="locationList" class="space-y-3">
                    <div class="animate-pulse space-y-2">
                        <div class="h-8 bg-zinc-800 rounded"></div>
                        <div class="h-8 bg-zinc-800 rounded"></div>
                        <div class="h-8 bg-zinc-800 rounded"></div>
                    </div>
                </div>
            </div>

            <div class="hacker-border p-6 rounded-sm">
                <h3 class="text-xs font-bold text-zinc-400 mb-6 uppercase tracking-widest lang-key" data-key="personality-dist">人格分布排行</h3>
                <div id="personalityDistribution" class="space-y-3">
                    <div class="animate-pulse space-y-2">
                        <div class="h-8 bg-zinc-800 rounded"></div>
                        <div class="h-8 bg-zinc-800 rounded"></div>
                        <div class="h-8 bg-zinc-800 rounded"></div>
                    </div>
                </div>
            </div>

            <div class="hacker-border p-6 rounded-sm flex flex-col">
                <h3 class="text-xs font-bold text-zinc-400 mb-6 uppercase tracking-widest lang-key" data-key="recent-activity">实时诊断活动</h3>
                <div id="recentActivity" class="flex-1 overflow-y-auto max-h-[300px] text-[10px] font-mono space-y-4 pr-2">
                    <!-- Logs here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- 悬浮抽屉式在线用户列表 -->
    <div id="private-inbox-drawer">
        <div class="inbox-header">
            <span class="inbox-title">私信收件箱</span>
            <button type="button" class="inbox-close" onclick="closeInboxDrawer()">✕</button>
        </div>
        <div class="inbox-body" id="inbox-body">
            <div class="text-zinc-500 text-center py-8 text-xs">加载中...</div>
        </div>
    </div>

    <div id="live-nodes-drawer" class="live-nodes-drawer expanded">
        <div class="live-nodes-header" onclick="toggleDrawer()">
            <div class="flex items-center gap-3">
                <span class="text-[10px] text-zinc-500 uppercase tracking-widest lang-key" data-key="active-nodes">Live Nodes</span>
                <span id="online-count-badge" class="w-2 h-2 bg-[var(--accent-terminal)] rounded-full pulse"></span>
                <span id="online-count-text" class="text-xs font-bold text-[var(--accent-terminal)]">0</span>
            </div>
            <svg class="chevron-icon w-4 h-4 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
        </div>
        <div class="live-nodes-content">
            <div id="online-users-list" class="p-4 space-y-2">
                <div class="text-zinc-500 text-center py-4 text-[10px]">Scanning for nearby nodes...</div>
            </div>
        </div>
    </div>

    
    <!-- 关注点分离：先依赖层，再数据层，再渲染层，最后入口与 Auth。本国词云依赖 WordCloud2.js -->
    <script src="assets/js/stats-libs.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.2.2/wordcloud2.min.js" defer></script>
    <script src="assets/js/stats-data-service.js" defer></script>
    <script src="assets/js/stats-ui-renderer.js" defer></script>
    <script src="assets/js/stats2.js" defer></script>
</body>
</html>