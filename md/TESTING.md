# 上传功能测试指南

## 测试步骤

### 1. 本地测试

#### 启动应用
```bash
# Windows
start.bat

# 或
npm run dev
```

浏览器应该自动打开 `http://localhost:3000`

### 2. 测试文件夹上传

#### 步骤
1. 点击"选择文件夹"按钮
2. 选择 Cursor 的 workspaceStorage 目录
3. 观察是否弹出文件选择对话框

#### 预期结果
- ✅ 文件选择对话框正常打开
- ✅ 可以浏览文件夹
- ✅ 选择后显示加载状态
- ✅ 显示"已处理 X/Y 个文件"

#### 调试方法
1. 按 F12 打开开发者工具
2. 查看 Console 标签页
3. 应该看到类似日志：
```
[Main] 点击选择文件夹按钮
[Main] 文件夹选择事件触发
[Main] 处理文件上传，类型: folder
[Main] event.files.length: 123
[Main] 选择了 123 个文件
```

### 3. 测试单文件上传

#### 步骤
1. 点击"选择单个文件"按钮
2. 选择一个 `.vscdb` 文件
3. 观察处理过程

#### 预期结果
- ✅ 文件选择对话框正常打开
- ✅ 可以选择多个文件
- ✅ 选择后显示加载状态
- ✅ 显示"已处理 1/1 个文件"

#### 调试日志
```
[Main] 点击选择文件按钮
[Main] 文件选择事件触发
[Main] 处理文件上传，类型: file
[Main] 单文件模式：找到 1 个数据库文件
```

### 4. 错误场景测试

#### 场景 1：没有选择文件
- **操作**：打开文件选择框后直接取消
- **预期**：不显示错误，保持在上传界面

#### 场景 2：选择的文件夹没有 .vscdb 文件
- **操作**：选择一个不包含 .vscdb 的文件夹
- **预期**：显示红色错误提示"未找到 state.vscdb 文件"
- **日志**：显示处理失败的错误

#### 场景 3：选择的文件不是数据库文件
- **操作**：选择一个非数据库文件（如 .txt）
- **预期**：显示错误提示"未找到有效的数据库文件"

#### 场景 4：数据库文件为空
- **操作**：选择一个空的 .vscdb 文件
- **预期**：显示错误提示"未找到任何对话数据"

## 浏览器兼容性

### ✅ 完全支持
- Chrome 90+
- Edge 90+
- Opera 76+

### ⚠️ 部分支持
- Firefox：不支持文件夹上传，但支持单文件上传
- Safari：不支持文件夹上传，但支持单文件上传

### ❌ 不支持
- IE 11 及以下

## 常见问题排查

### 问题 1：点击按钮没反应

#### 检查步骤
1. 检查浏览器控制台是否有错误
2. 检查按钮是否被禁用（灰色）
3. 检查是否有弹窗被拦截

#### 解决方案
- 允许浏览器访问文件（查看地址栏提示）
- 检查是否有 JavaScript 错误
- 尝试刷新页面

### 问题 2：文件选择框打开后无法选择文件夹

#### 原因
- 浏览器不支持 `webkitdirectory` 属性

#### 解决方案
- 使用 Chrome 或 Edge 浏览器
- 或使用"选择单个文件"功能

### 问题 3：上传后一直显示加载状态

#### 检查步骤
1. 查看控制台日志，确认是否进入处理流程
2. 检查是否有 JavaScript 错误
3. 检查网络请求（如果有）

#### 可能原因
- 文件太大，处理时间过长
- WebAssembly 加载失败
- 数据库解析出错

#### 解决方案
- 等待更长时间
- 检查控制台错误
- 尝试上传更小的文件测试

### 问题 4：显示错误信息但不知道具体原因

#### 调试步骤
1. 打开浏览器控制台（F12）
2. 查看 Console 标签页
3. 查找红色的错误信息
4. 截图发送以便诊断

## 性能测试

### 小型数据库（< 1MB）
- 预期处理时间：< 1 秒
- 文件数量：10 个以内

### 中型数据库（1-10MB）
- 预期处理时间：1-5 秒
- 文件数量：10-50 个

### 大型数据库（> 10MB）
- 预期处理时间：5-30 秒
- 文件数量：50+ 个

## 安全测试

### 测试项
- ✅ 文件内容不会上传到服务器
- ✅ 支持本地文件系统访问
- ✅ 只能读取用户选择的文件
- ✅ 不会修改任何本地文件

## 用户体验测试

### 测试项
- ✅ 加载状态清晰可见
- ✅ 错误信息友好易懂
- ✅ 支持重新上传
- ✅ 响应式布局（手机、平板、桌面）

## 测试报告模板

```
测试日期：______
测试环境：______
浏览器：______
操作系统：______

文件夹上传：
[ ] 成功
[ ] 失败 - 原因：______

单文件上传：
[ ] 成功
[ ] 失败 - 原因：______

错误处理：
[ ] 测试通过
[ ] 测试失败 - 原因：______

其他问题：______
```
