# 文件上传测试步骤

## 🔍 问题排查

如果您看到 "Cannot read image.png" 错误，说明您上传了错误的文件类型。

## ✅ 正确的上传方式

### 步骤 1：找到数据库文件

**Windows 用户**：

1. 按 `Win + R` 打开运行对话框
2. 输入 `%AppData%` 并回车
3. 打开 `Cursor` 文件夹
4. 打开 `User` 文件夹
5. 打开 `workspaceStorage` 文件夹
6. 你会看到很多文件夹，每个文件夹代表一个项目

**查找 state.vscdb 文件**：

```
workspaceStorage/
  ├── 80b2a3d4.../          # 项目 1
  │   └── state.vscdb       # ✅ 这就是数据库文件
  ├── c5f7e8b9.../          # 项目 2
  │   └── state.vscdb       # ✅ 这就是数据库文件
  └── ...
```

### 步骤 2：上传文件

**方式一：选择文件夹（推荐）**

1. 点击"选择文件夹（批量处理）"按钮
2. 选择 `workspaceStorage` 文件夹
3. 等待应用自动扫描所有项目

**方式二：选择单个文件**

1. 点击"选择单个文件"按钮
2. 选择一个 `state.vscdb` 文件
3. 立即开始处理

### 步骤 3：验证上传成功

打开浏览器控制台（按 F12），查看日志：

**成功的日志示例**：
```
[Main] 点击选择文件夹按钮
[Main] 文件夹选择事件触发
[Main] 处理文件上传，类型: folder
[Main] event.files.length: 123
[Main] 选择了 123 个文件
[Main] 文件列表:
  [1] file1.txt (1.2 KB)
  [2] file2.png (500 KB)
  ...
  [45] state.vscdb (2.3 MB)  ← 数据库文件
  [46] state.vscdb (1.8 MB)  ← 数据库文件
[Main] 文件夹模式：找到 2 个 state.vscdb 文件
[Main] 正在处理: state.vscdb
[Main] 文件大小: 2406400 bytes
[Main] 提取到 45 条记录
```

## ❌ 常见错误

### 错误 1：上传了图片文件

**错误信息**：
```
Cannot read "image.png" (this model does not support image input)
```

**原因**：您选择了图片文件而不是数据库文件

**解决**：
1. 检查您选择的文件，应该以 `.vscdb` 结尾
2. 重新选择正确的文件
3. 确保文件名是 `state.vscdb`，不是 `image.png` 或其他

### 错误 2：未找到数据库文件

**错误提示**：
```
未找到有效的数据库文件（.vscdb, .db, .sqlite, .sqlite3）
选择的是：image.png, test.txt, ...
```

**原因**：选择了错误的文件类型

**解决**：
- 只能选择 `.vscdb` 数据库文件
- 不能选择图片、文档、文本文件

### 错误 3：文件夹没有 .vscdb 文件

**错误提示**：
```
未找到 state.vscdb 文件
选中的文件包括：file1.txt, file2.png, ...
```

**原因**：选择了错误的文件夹

**解决**：
- 确保选择的是 `workspaceStorage` 文件夹本身
- 不要选择其父文件夹
- 确保文件夹内有子文件夹，每个子文件夹里有 `state.vscdb` 文件

## 🎯 快速测试

### 最简单的测试方法

1. 找到一个 `state.vscdb` 文件（应该有几个 MB 大小）
2. 点击"选择单个文件"按钮
3. 选择这个文件
4. 等待 3-10 秒
5. 查看是否显示统计卡片和图表

### 验证成功的标志

✅ 看到四个统计卡片：
- 总对话次数
- AI 产出代码
- 最常用模型
- 用户消息

✅ 看到两个图表：
- 编程时段热力图
- 模型使用分布

✅ 看到对话列表

## 🔧 调试方法

### 查看详细日志

1. 打开浏览器控制台（F12）
2. 切换到 Console 标签页
3. 清空日志（点击清除按钮）
4. 重新上传文件
5. 查看以 `[Main]` 开头的所有日志

### 关键日志说明

| 日志内容 | 含义 |
|---------|------|
| `[Main] 处理文件上传，类型: folder` | 开始文件夹上传 |
| `[Main] event.files.length: 123` | 选择了 123 个文件 |
| `[Main] 文件夹模式：找到 2 个 state.vscdb 文件` | 找到 2 个数据库 |
| `[Main] 正在处理: state.vscdb` | 正在处理数据库 |
| `[Main] 文件大小: 2406400 bytes` | 文件大小约 2.3 MB |
| `[Main] 提取到 45 条记录` | 成功提取 45 条对话 |

## 📊 文件大小参考

| 文件类型 | 大小范围 | 说明 |
|---------|---------|------|
| state.vscdb | 1-100 MB | 正常大小 |
| 图片文件 | 10 KB - 10 MB | ❌ 不支持 |
| 文本文件 | 1 KB - 1 MB | ❌ 不支持 |
| 文档文件 | 10 KB - 10 MB | ❌ 不支持 |

## 🆘 还是不行？

### 最后的检查清单

- [ ] 使用的是 Chrome 或 Edge 浏览器
- [ ] 选择的文件名是 `state.vscdb`
- [ ] 文件大小至少 1 MB
- [ ] 控制台没有红色错误信息
- [ ] 已经等待至少 10 秒

### 收集诊断信息

如果还是失败，请提供：

1. **控制台日志截图**（F12 → Console）
2. **错误提示文字**（红色框中的文字）
3. **选择的文件列表**（控制台日志中的文件列表）
4. **浏览器版本**（F12 → Console 输入 `navigator.userAgent`）

## ✅ 成功示例

### 控制台日志（成功）
```
[Main] 点击选择单个文件按钮
[Main] 文件选择事件触发
[Main] 处理文件上传，类型: file
[Main] event.files.length: 1
[Main] 选择了 1 个文件
[Main] 文件列表:
  [1] state.vscdb (2.3 MB)
[Main] 单文件模式：找到 1 个数据库文件
[Main] 正在处理: state.vscdb
[Main] 文件大小: 2406400 bytes
[Main] 提取到 45 条记录
[Main] 总共提取 45 条对话记录
```

### 界面显示（成功）
```
┌─────────────────────────┐
│ 💬 总对话次数: 45        │
│ ⚡ AI 产出代码: 12,456   │
│ 🤖 最常用模型: gpt-4     │
│ 👤 用户消息: 23          │
└─────────────────────────┘

📊 编程时段热力图
📊 模型使用分布
📝 最喜爱提示词 Top 5
```

---

**需要更多帮助？** 查看 `QUICK_FIX.md` 获取详细排查步骤。
