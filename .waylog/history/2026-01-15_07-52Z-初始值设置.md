# 初始值设置
_Exported on 01/15/2026 at 16:05:24 GMT+8 from Cursor via WayLog_


**User**

我希望是初始值是0，而不是25000

---


**User**

我希望是统计用户数初始值是0，而不是25000

---


**Cursor**

查找并修改“全网受虐人数”的初始值，从25000改为0。



查找代码中设置25000的位置：



继续查看 API 获取失败时的处理逻辑：



检查 main.js 中是否有设置 25000 的逻辑：



检查 main.js 中的 DEFAULT_VALUE 常量：

---


**User**

还是2.5万，是否cloudflare的问题？export default {
  async fetch(request, env) {
    const corsHeaders = {
      "Access-Control-Allow-Origin": "*", // 允许 GitHub Pages 跨域
      "Access-Control-Allow-Methods": "GET, POST, OPTIONS",
      "Access-Control-Allow-Headers": "Content-Type",
    };

    // 1. 处理预检请求 (OPTIONS)
    if (request.method === "OPTIONS") {
      return new Response(null, { headers: corsHeaders });
    }

    const key = "total_users";
    const clientIP = request.headers.get("CF-Connecting-IP") || "anonymous";
    const userLockKey = `lock_${clientIP}`;

    try {
      // --- 处理 POST 请求 (上报新用户) ---
      if (request.method === "POST") {
        const alreadyCounted = await env.STATS_STORE.get(userLockKey);
        let countStr = await env.STATS_STORE.get(key);
        let count = countStr ? parseInt(countStr) : 0;

        let action = "skipped_duplicate";
        if (!alreadyCounted) {
          count += 1;
          await env.STATS_STORE.put(key, count.toString());
          // 锁定该 IP 24 小时
          await env.STATS_STORE.put(userLockKey, "true", { expirationTtl: 86400 });
          action = "incremented";
        }

        return new Response(JSON.stringify({ value: count, action }), {
          headers: { ...corsHeaders, "Content-Type": "application/json" }
        });
      }

      // --- 处理 GET 请求 (获取总数) ---
      // 修复 500 错误的关键：显式处理所有非 POST 请求为获取数据
      let countStr = await env.STATS_STORE.get(key);
      let count = countStr ? parseInt(countStr) : 0;

      return new Response(JSON.stringify({ value: count, status: "success" }), {
        headers: { ...corsHeaders, "Content-Type": "application/json" }
      });

    } catch (e) {
      // 返回具体的错误信息方便调试
      return new Response(JSON.stringify({ error: e.message }), {
        status: 500,
        headers: { ...corsHeaders, "Content-Type": "application/json" }
      });
    }
  }
};

---


**Cursor**

检查前端代码，确认是否从 Cloudflare API 获取了 25000。同时检查 Cloudflare Worker 代码，确保初始值为 0。



问题在于 Cloudflare KV 存储中已有 25000，所以 API 返回该值。检查前端代码逻辑，并修改为：即使 API 返回 25000，初始显示也为 0；同时提供重置 KV 存储的方案。

---
